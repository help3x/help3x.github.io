Windows - タスクスケジューラのリトライについて
=============

原典: [タスクスケジューラのリトライについて &#x7c; teratail](https://teratail.com/questions/78141)


タスクスケジューラ側でバッチが正常終了したか異常終了したかを取ることはできなさそう。  
タスクスケジューラ側で再実行するのではなく、バッチ側で異常終了したら再実行するというアプローチにする。


↓↓↓



────────────────────────────────────────



お世話になっております。 

以下の内容を実現させたいのですが、いい方法をご存知でしたら 
 ご教授願います。 

■環境 
WindowsServer2012R2 

■やりたいこと 
①所定のフォルダに、所定のファイル(受領ファイル)がある場合、 
そのファイルをDBに取り込むというbatがあります 

②タスクスケジューラで①のbatを時間登録し、 
(i)ファイルが配置されていればDBに取り込み、繰り返しなしで終了 
(ⅱ)ファイルが配置されていなければ5分間隔でリトライさせ、最終的にDBに取り込ませたい(受領ファイルが配置されるまで実行したい) 

■わからないこと 
 タスクスケジューラでは、タスク失敗時の設定は出来ますが、 
そもそも「タスク失敗」とは指定したbatがないなどの場合だと思います。 

ファイルの有無に関わらず、batは正常に終了してしまうことになってしまいますので、 
 上記のやりたいことに記載している内容はどのように実装すれば実現可能でしょうか。 

どうぞ、よろしくお願いいたします。 



────────────────────────────────────────



受領ファイルがあるかどうかを調べて、もしあるならそのまま実行、 
なければ5分後に読み込みなおすというロジックにすればよいのではないでしょうか？ 

ファイルをもう一度読み込む前に 
TIMEOUT /T 300 /NOBREAK 
をつけておけば待機になります。



────────────────────────────────────────



2017/05/29 14:27 

>>s.t.様
ご回答ありがとうございます。
つまり、「タスクスケジューラではbatのキックのみを行い、
bat側でリトライ処理を組み込む」という認識で合っていますでしょうか。
 参考になります。
そうしますと、やはりタスクスケジューラ側での実現は厳しいのでしょうか。



────────────────────────────────────────



2017/05/29 14:32 

その認識であっています。

タスクスケジューラ側でやったことがないのですが
https://121ware.com/qasearch/1007/app/servlet/relatedqa?QID=012124
ここに失敗したときの再起動の設定方法があります。
あとはbatが失敗したという認識をどのように行うかが問題です。
EXIT 1 で終了時に失敗するコードとなるようですが、タスクスケジューラ側に伝わるかどうかはやったことがないので・・・すみません。



────────────────────────────────────────



2017/05/29 15:02 

>>s.t.様
ご回答ありがとうございます。
いろいろと調べてみましたが、”bat内部でのエラー”をタスクスケジューラで拾うことは
 できないという記事が多数でした。
また「EXIT 1 で終了時に失敗するコードとなるようですが、タスクスケジューラ側に伝わるかどうか」も実際に試してみましたが、やはり正常終了扱いとなりました。
ですので、ご回答頂きました通り、bat側でリトライ処理を組み込むことにします。
ありがとうございました！
