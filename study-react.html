<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>React学習 事始め</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1>React学習 事始め</h1>
<h2>実施環境</h2>
<ul>
<li>Windows 7 Professional Service Pack 1</li>
<li>node v8.9.4</li>
<li>npm 4.0.5</li>
</ul>
<h2>はじめに</h2>
<dl>
<dt>React</dt>
<dd>Webの見た目を作ることに特化したJavaScriptライブラリ。 Viewに関連する機能だけを持つ。
</dd>
<dt>Flux</dt>
<dd><p>見た目とデータの分離のアーキテクチャ。 次のように、データの流れを一方向だけに流れるようにして、不整合が発生しにくい仕組みになっている。</p>
<ol>
<li>View はユーザーの入力から Action を作成する。</li>
<li>Action を Dispatch することで Store にデータを保存する。</li>
<li>Store を View に反映する。</li>
</ol>
<!-- -->
<pre><code>              ┌─── Action ←─┐
              ↓                  ｜
Action → Dispatcher → Store → View</code></pre>
</dd>
</dl>
<p>Redux Fluxアーキテクチャの実装。</p>
<!--
- View
- Action
- Store
- Dispatcher
- Reducer
    状態を変化させるための関数です。Actionの内容によって既存の状態を変化させます。
-->
<p>オブジェクトや配列の操作を行う場合は、基本的には参照渡しでなく値のコピーを渡します。 参照を切る方法としてES2015で標準化された<code>Object.assign()</code>メソッドを使ってもよいです。</p>
<p>Spread Operatorでも可。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dt">status</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="op">};</span></a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="cf">return</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> state<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="dt">state</span><span class="op">:</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h2>環境構築</h2>
<h3>node.jsのインストール</h3>
<p>割愛します。</p>
<p>Windowsユーザーであれば nodist を入れればよいかと。</p>
<h3>create-react-app のインストール</h3>
<p>作業フォルダを作りその中にインストールします。</p>
<pre><code>&gt; mkdir react1st &amp; cd react1st
&gt; npm install create-react-app</code></pre>
<h3>アプリケーションの作成</h3>
<p><code>create-react-app</code>コマンドを使ってアプリケーションを作成します。</p>
<p>構文 create-react-app <application-name></p>
<p><code>my-app</code>アプリケーションを作成してみます。</p>
<pre><code>  &gt; .\node_modules\.bin\create-react-app my-app</code></pre>
<p>作成されたアプリケーションの構成は以下のようになっています。</p>
<pre><code>.
+---node_modules
+---public
|   +---favicon.ico
|   +---index.html
|   `---manifest.json
+---src
|   +---App.css
|   +---App.js
|   +---App.test.js
|   +---index.css
|   +---index.js
|   +---logo.svg
|   `---registerServiceWorker.js
+---.gitignore
+---package.json
`---README.md</code></pre>
<h3>開発モードでアプリケーションを起動</h3>
<p>アプリケーションのルートフォルダ（<code>my-app</code>フォルダ）に移動し、<code>npm start</code>コマンドを実行します。 ブラウザが自動で起動し、アプリケーションが表示されます。 もし、ブラウザが起動しなかったときは自分で起動して<code>http://localhost:3000/</code>にアクセスしてください。</p>
<pre><code>&gt; cd my-app
&gt; npm start</code></pre>
<h4>開発モードの機能</h4>
<p>開発モードは次の動作になります。 開発モードを終了するには、Control＋Cキーを押します。</p>
<ul>
<li>ソースコードの変更を監視し、アプリケーションを自動でビルドする。</li>
<li>ブラウザを自動でリロードする。</li>
<li>コンソールにビルドエラーとlintの警告を表示する。</li>
</ul>
<h3>Hello, World! の表示</h3>
<p><code>src\App.js</code>ファイルを以下のように編集します。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="op">&lt;</span>h1 className<span class="op">=</span><span class="st">&quot;App-title&quot;</span><span class="op">&gt;</span>Welcome to React&lt;/h1<span class="op">&gt;</span></a></code></pre></div>
<p>↓</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="op">&lt;</span>h1 className<span class="op">=</span><span class="st">&quot;App-title&quot;</span><span class="op">&gt;</span>Hello<span class="op">,</span> World<span class="op">!</span>&lt;/h1<span class="op">&gt;</span></a></code></pre></div>
<p>保存に伴い、ブラウザが自動でリロードされ、修正内容が反映されます。</p>
<h2>JSX</h2>
<dl>
<dt>JSX</dt>
<dd>JavaScriptを拡張した言語。 ReactとJSXを一緒に使うことが推奨されています（必須ではない）。
</dd>
</dl>
<ul>
<li>JSXでは、JavaScriptのなかにHTMLのタグや属性を（ほぼ）同じように書くことができる。</li>
<li>最終的にトランスパイラでJavaScriptに変換して使う。 このとき、JSXに書いたタグは、<code>React.createElement</code>関数の呼び出しに変換される。</li>
</ul>
<dl>
<dt>トランスパイラ</dt>
<dd>ソースコードを別のソースコードに変換するツールのことです。 BabelのほかCoffeeScriptやTypeScriptなどがあります。
</dd>
</dl>
<h3>JSXの使い方</h3>
<ul>
<li><p>JSXのタグは<code>React.createElement</code>に変換されるため、Reactのインポートが必要です。</p>
<pre><code>  import React from 'react';</code></pre></li>
<li><p><code>{}</code>で囲むと式をJSXに埋め込むことができます。</p>
<pre><code>  const fullnames = {
    ryoma: '坂本竜馬'
  };
  const getFullname = nickname =&gt; fullnames[nickname];
  const element = &lt;h1&gt;Hello, {getFullname('ryoma')}&lt;/h1&gt;;</code></pre></li>
</ul>
<h2>babelのインストール</h2>
<ol>
<li><p>作業ディレクトリを作り、その中に移動します。</p>
<pre><code> &gt; mkdir babel-cli-example &amp; cd babel-cli-example</code></pre></li>
<li><p>空のpackage.jsonを作ります。</p>
<pre><code> &gt; echo {} &gt; package.json</code></pre></li>
<li><p>Babel関連のパッケージをインストールします。</p>
<pre><code> &gt; npm install --save-dev babel-cli babel-preset-react</code></pre></li>
</ol>
<p>babel-cli BabelをCLI上で動作させるためのパッケージです。 Babelを使ったソースコードの変換を行うbabelコマンドと、変換に加えて変換後のソースコードをそのままNode.jsで実行するbabel-nodeコマンドを含んでいます。</p>
<h3>react向けに変換するコマンド</h3>
<pre><code>.\node_modules\.bin\babel [Options...] target-file</code></pre>
<p>e.g.,</p>
<pre><code>.\node_modules\.bin\babel --presets=react input.js</code></pre>
<p>標準出力ではなくファイルに出力するときは、<code>--out-file</code>オプションにファイル名を指定します。</p>
<pre><code>.\node_modules\.bin\babel --presets=react input.js --out-file output.js</code></pre>
<dl>
<dt>webpack</dt>
<dd>モジュールバンドラー。<br />
ES ModulesやNode.jsで利用されているCommonJSのモジュール方式で記述されたソースファイルを束ねて、ブラウザで実行可能な静的なJavaScriptファイルを出力します。
</dd>
</dl>
<ol>
<li><p>作業ディレクトリを作り、その中に移動します。</p>
<pre><code> &gt; mkdir webpack-example &amp; cd webpack-example</code></pre></li>
<li><p>空のpackage.jsonを作ります。</p>
<pre><code> &gt; echo {} &gt; package.json</code></pre></li>
<li><p>開発に使うパッケージをインストールします（<code>--save-dev</code>オプションをつけます）。</p>
<pre><code> &gt; npm install --save-dev ^
   webpack ^
   webpack-cli ^
   babel-loader ^
   babel-core ^
   babel-preset-react</code></pre></li>
<li><p>実行に使うパッケージをインストールします（<code>--save</code>オプションをつけます）。</p>
<pre><code> &gt; npm install --save ^
   react ^
   react-dom</code></pre></li>
</ol>
<!--
--save-devインストール

- webpack
- webpack-cli
- babel-loader
- babel-core
- babel-preset-react

--saveインストール

- react
- react-dom
-->
<p>Webpackのバージョンを表示</p>
<pre><code>.\node_modules\.bin\webpack --version
4.1.0</code></pre>
<dl>
<dt>Hello.js</dt>
<dd><div class="sourceCode" id="cb23"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="co">// export default function で</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="co">// Hello コンポーネントを持っていることを外部に知らせる</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">Hello</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6">  <span class="cf">return</span> <span class="op">&lt;</span>h1<span class="op">&gt;</span>Hello<span class="op">!</span> webpack&lt;/h1<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="op">}</span></a></code></pre></div>
</dd>
<dt>entry.js</dt>
<dd><div class="sourceCode" id="cb24"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">'react-dom'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="im">import</span> Hello <span class="im">from</span> <span class="st">'./Hello'</span><span class="op">;</span>    <span class="co">// ← Hello.js の読み込み</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">  <span class="op">&lt;</span>Hello /<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'root'</span>)</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">)<span class="op">;</span></a></code></pre></div>
</dd>
</dl>
<p>importのパスが絶対パスでも相対パスでもない場合、webpackはnpmモジュールから読み込みます。</p>
<p>webpack.config.js</p>
<p>webpackの設定ファイルは、JSON、XML、YAMLなどのフォーマットを記述できます。<br />
フォーマットの判別は設定ファイルの拡張子で行います。</p>
<p>JavaScriptであれば、Node.jsのモジュールとして扱うので、<code>module.exports</code>に代入しているオブジェクトが設定ファイルとして利用されます。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">  <span class="co">// entryフィールド</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3">  <span class="co">// 実行の起点となるファイルの指定</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4">  <span class="dt">entry</span><span class="op">:</span> <span class="st">'./entry.js'</span><span class="op">,</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb25-6" data-line-number="6">  <span class="co">// outputフィールド</span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7">  <span class="co">// 出力に関する設定</span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8">  <span class="dt">output</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-9" data-line-number="9">    <span class="dt">filename</span><span class="op">:</span> <span class="st">'output.js'</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10">  <span class="op">},</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb25-12" data-line-number="12">  <span class="dt">module</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-13" data-line-number="13">    <span class="dt">rules</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb25-14" data-line-number="14">      <span class="co">// babel-loader の設定</span></a>
<a class="sourceLine" id="cb25-15" data-line-number="15">      <span class="co">// ファイルごとに適応するLoaderの設定を書く</span></a>
<a class="sourceLine" id="cb25-16" data-line-number="16">      <span class="op">{</span></a>
<a class="sourceLine" id="cb25-17" data-line-number="17">        <span class="dt">loader</span><span class="op">:</span> <span class="st">'babel-loader'</span><span class="op">,</span></a>
<a class="sourceLine" id="cb25-18" data-line-number="18">        <span class="dt">test</span><span class="op">:</span> <span class="ss">/</span><span class="sc">\.</span><span class="ss">js</span><span class="sc">$</span><span class="ss">/</span><span class="op">,</span></a>
<a class="sourceLine" id="cb25-19" data-line-number="19">        <span class="dt">options</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-20" data-line-number="20">          <span class="dt">presets</span><span class="op">:</span> [<span class="st">'react'</span>]</a>
<a class="sourceLine" id="cb25-21" data-line-number="21">        <span class="op">}</span></a>
<a class="sourceLine" id="cb25-22" data-line-number="22">      <span class="op">}</span></a>
<a class="sourceLine" id="cb25-23" data-line-number="23">    ]</a>
<a class="sourceLine" id="cb25-24" data-line-number="24">  <span class="op">}</span></a>
<a class="sourceLine" id="cb25-25" data-line-number="25"><span class="op">};</span></a></code></pre></div>
<p>webpackを実行</p>
<p><code>dist\output.js</code>が出力されます。</p>
<pre><code>&gt; .\node_modules\.bin\webpack --config webpack.config.js</code></pre>
<p><code>dist\index.html</code>を作成します。</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;ja&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="kw">&lt;meta</span><span class="ot"> http-equiv=</span><span class="st">&quot;X-UA-Compatible&quot;</span><span class="ot"> content=</span><span class="st">&quot;IE=edge&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="kw">&lt;title&gt;</span>webpack test<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10">  <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;root&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11">  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;./output.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></a>
<a class="sourceLine" id="cb27-12" data-line-number="12"><span class="kw">&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb27-13" data-line-number="13"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<p>ブラウザで表示。</p>
<p><code>output.js</code>の読み込みだけで表示されました。 動作に必要なスクリプト（<code>react.min.js</code>や<code>react-dom.min.js</code>）が、webpackによってすべて<code>output.js</code>に束ねられているからです。</p>
<h2>Reactコンポーネント</h2>
<p>create-react-app による開発は、自動作成された「src\index.js」や、その中で読み込んでいる「src\App.js」を編集して動作を確かめます。 ファイルやフォルダを分けてコードを管理するのもありです。</p>
<h3>Reactコンポーネントの種類</h3>
<h4>Functional Component</h4>
<p>関数によって定義されるコンポーネント。</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="kw">const</span> Hello <span class="op">=</span> (props) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4">  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>こんにちは、<span class="op">{</span><span class="va">props</span>.<span class="at">name</span><span class="op">}</span>さん&lt;/div<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="op">};</span></a></code></pre></div>
<h4>Class Component</h4>
<p>クラスによって定義されるコンポーネント。</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">class</span> Hello <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2">  <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3">    <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>こんにちは、<span class="op">{</span><span class="kw">this</span>.<span class="va">props</span>.<span class="at">name</span><span class="op">}</span>さん&lt;/div<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="op">};</span></a></code></pre></div>
<h5>Functional Componentとの違い</h5>
<ul>
<li><code>React.Component</code>を明示的に継承している。</li>
<li>propsの受け取り方がthis.propsとなっている。</li>
<li>コンポーネントの状態を記録する仕組みがある（state）。</li>
<li>ライフサイクルメソッドという特殊なメソッドが定義できる。</li>
</ul>
<h3>コンポーネントの再利用</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">const</span> Hello <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>こんにちは、坂本竜馬さん&lt;/div<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"></a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb30-6" data-line-number="6">  <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7">    <span class="op">&lt;</span>Hello /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8">    <span class="op">&lt;</span>Hello /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb30-9" data-line-number="9">    <span class="op">&lt;</span>Hello /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb30-10" data-line-number="10">  &lt;/div<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb30-11" data-line-number="11">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;root&quot;</span>)</a>
<a class="sourceLine" id="cb30-12" data-line-number="12">)<span class="op">;</span></a></code></pre></div>
<dl>
<dt>Reactコンポーネント</dt>
<dd>設計図のようなもの。 オブジェクト指向でいえば〝クラス〟にあたる。
</dd>
<dt>Reactエレメント</dt>
<dd>設計図（Reactコンポーネント）を元に作られた実体のこと。 オブジェクト指向でいえば〝インスタンス〟にあたる。
</dd>
</dl>
<div class="sourceCode" id="cb31"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co">// こちらはReactコンポーネント</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="kw">const</span> Hello <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3">  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>こんにちは、坂本竜馬さん&lt;/div<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="op">};</span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"></a>
<a class="sourceLine" id="cb31-6" data-line-number="6"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb31-7" data-line-number="7">  <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8">    以下のHello3つはどれも React エレメント</a>
<a class="sourceLine" id="cb31-9" data-line-number="9">    <span class="op">&lt;</span>Hello /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb31-10" data-line-number="10">    <span class="op">&lt;</span>Hello /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb31-11" data-line-number="11">    <span class="op">&lt;</span>Hello /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb31-12" data-line-number="12">  &lt;/div<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb31-13" data-line-number="13">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;root&quot;</span>)</a>
<a class="sourceLine" id="cb31-14" data-line-number="14">)<span class="op">;</span></a></code></pre></div>
<h3>Fragmentコンポーネント</h3>
<p>Reactコンポーネントは単一の親からなる要素しか表現できません。 複数の要素をラップする要素を使ってもよいのですが、これではもともと表現したかったHTML構造にならないことがあります。</p>
<p>React.Fragmentコンポーネントを使うとこの制約をクリアすることができます。</p>
<p>↓ダメな例</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">const</span> Hello <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">    <span class="op">&lt;</span>div<span class="op">&gt;</span>こんにちは&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4">    <span class="op">&lt;</span>div<span class="op">&gt;</span>坂本竜馬さん&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="op">};</span></a></code></pre></div>
<p>↓ラップして対処する方法</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">const</span> Hello <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4">      <span class="op">&lt;</span>div<span class="op">&gt;</span>こんにちは&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5">      <span class="op">&lt;</span>div<span class="op">&gt;</span>坂本竜馬さん&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb33-6" data-line-number="6">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb33-7" data-line-number="7">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb33-8" data-line-number="8"><span class="op">};</span></a></code></pre></div>
<p>↓こうする</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">const</span> Hello <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">    <span class="op">&lt;</span><span class="va">React</span>.<span class="at">Fragment</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb34-4" data-line-number="4">      <span class="op">&lt;</span>div<span class="op">&gt;</span>こんにちは&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb34-5" data-line-number="5">      <span class="op">&lt;</span>div<span class="op">&gt;</span>坂本竜馬さん&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb34-6" data-line-number="6">    &lt;/<span class="va">React</span>.<span class="at">Fragment</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb34-7" data-line-number="7">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb34-8" data-line-number="8"><span class="op">};</span></a></code></pre></div>
<h3>データの受け渡し（props）</h3>
<div class="sourceCode" id="cb35"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">const</span> Hello <span class="op">=</span> (props) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2">  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>こんにちは、<span class="op">{</span><span class="va">props</span>.<span class="at">name</span><span class="op">}</span>さん&lt;/div<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4"></a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb35-6" data-line-number="6">  <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7">    <span class="op">&lt;</span>Hello name<span class="op">=</span><span class="st">&quot;A&quot;</span> /&gt;</a>
<a class="sourceLine" id="cb35-8" data-line-number="8">    <span class="op">&lt;</span>Hello name<span class="op">=</span><span class="st">&quot;B&quot;</span> /&gt;</a>
<a class="sourceLine" id="cb35-9" data-line-number="9">    <span class="op">&lt;</span>Hello name<span class="op">=</span><span class="st">&quot;C&quot;</span> /&gt;</a>
<a class="sourceLine" id="cb35-10" data-line-number="10">  &lt;/div<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb35-11" data-line-number="11">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;root&quot;</span>)</a>
<a class="sourceLine" id="cb35-12" data-line-number="12">)<span class="op">;</span></a></code></pre></div>
<p>Helloの関数の引数に<code>props</code>を追加します。引数の名前はなんでもいいですが、<code>props</code>にするのが一般的。</p>
<p><code>props</code>の引数にはコンポーネントを使う側で指定した内容が入ります。</p>
<p>上記でいえば、<code>&lt;Hello name=&quot;A&quot; /&gt;</code>として使っているので、<code>props</code>には<code>name</code>というプロパティが追加され、「A」が格納されます。同様に<code>&lt;Hello name=&quot;B&quot; /&gt;</code>であれば、<code>props.name</code>の値は「B」になります。</p>
<p><code>props</code>には文字列、数値、配列、オブジェクト、関数など任意の値を指定できます。 渡す値は<code>{}</code>で囲みます。</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="co">// 文字列</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="op">&lt;</span>Component stringValue<span class="op">={</span> <span class="st">&quot;坂本竜馬&quot;</span> <span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb36-3" data-line-number="3"></a>
<a class="sourceLine" id="cb36-4" data-line-number="4"><span class="co">// 数値</span></a>
<a class="sourceLine" id="cb36-5" data-line-number="5"><span class="op">&lt;</span>Component numberValue<span class="op">={</span><span class="dv">42</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb36-6" data-line-number="6"></a>
<a class="sourceLine" id="cb36-7" data-line-number="7"><span class="co">// 真偽値</span></a>
<a class="sourceLine" id="cb36-8" data-line-number="8"><span class="op">&lt;</span>Component boolValue<span class="op">={</span><span class="kw">true</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb36-9" data-line-number="9"></a>
<a class="sourceLine" id="cb36-10" data-line-number="10"><span class="co">// 配列</span></a>
<a class="sourceLine" id="cb36-11" data-line-number="11"><span class="op">&lt;</span>Component arrayValue<span class="op">={</span>[<span class="st">&quot;Aさん&quot;</span><span class="op">,</span> <span class="st">&quot;Bさん&quot;</span><span class="op">,</span> <span class="st">&quot;Cさん&quot;</span>]<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb36-12" data-line-number="12"></a>
<a class="sourceLine" id="cb36-13" data-line-number="13"><span class="co">// オブジェクト</span></a>
<a class="sourceLine" id="cb36-14" data-line-number="14"><span class="op">&lt;</span>Component objectValue<span class="op">={{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Aさん&quot;</span><span class="op">,</span> <span class="dt">birthDay</span><span class="op">:</span> <span class="st">&quot;1836/01/03&quot;</span><span class="op">}}</span> /&gt;</a>
<a class="sourceLine" id="cb36-15" data-line-number="15"></a>
<a class="sourceLine" id="cb36-16" data-line-number="16"><span class="co">// 関数</span></a>
<a class="sourceLine" id="cb36-17" data-line-number="17"><span class="op">&lt;</span>Component funcValue<span class="op">={</span>(name) <span class="op">=&gt;</span> <span class="va">console</span>.<span class="at">log</span>(name)<span class="op">;}</span> /&gt;</a>
<a class="sourceLine" id="cb36-18" data-line-number="18"></a>
<a class="sourceLine" id="cb36-19" data-line-number="19"><span class="co">// 変数</span></a>
<a class="sourceLine" id="cb36-20" data-line-number="20"><span class="kw">const</span> name <span class="op">=</span> <span class="st">&quot;Aさん&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb36-21" data-line-number="21"><span class="op">&lt;</span>Component value<span class="op">={</span>name<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb36-22" data-line-number="22"></a>
<a class="sourceLine" id="cb36-23" data-line-number="23"><span class="co">// 複数の値も渡せます</span></a>
<a class="sourceLine" id="cb36-24" data-line-number="24"><span class="op">&lt;</span>Component name<span class="op">={</span> <span class="st">&quot;Aさん&quot;</span> <span class="op">}</span> birthDay<span class="op">={</span> <span class="kw">new</span> <span class="at">Date</span>(<span class="dv">1836</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">3</span>) <span class="op">}</span> /&gt;</a></code></pre></div>
<p><code>props.children</code></p>
<p>Reactコンポーネントの子要素が渡されるプロパティです。</p>
<p>次の場合、<code>props.children</code>には「坂本竜馬」が渡されます。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">const</span> Hello <span class="op">=</span> (props) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2">  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>こんにちは、<span class="op">{</span><span class="va">props</span>.<span class="at">children</span><span class="op">}</span>さん&lt;/div<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb37-4" data-line-number="4"></a>
<a class="sourceLine" id="cb37-5" data-line-number="5"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb37-6" data-line-number="6">  <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb37-7" data-line-number="7">    <span class="op">&lt;</span>Hello<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb37-8" data-line-number="8">      坂本竜馬      ←Helloコンポーネントの子要素が渡される</a>
<a class="sourceLine" id="cb37-9" data-line-number="9">    &lt;/Hello<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb37-10" data-line-number="10">  &lt;/div<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb37-11" data-line-number="11">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&quot;root&quot;</span>)</a>
<a class="sourceLine" id="cb37-12" data-line-number="12">)<span class="op">;</span></a></code></pre></div>
<h3>propsの型チェック</h3>
<p>コンポーネントがどのようなpropsを受け取るのか記述することができます。 インターフェイスに合わない値が渡されたときに、エディタや実行時に警告を受け取ることができます。</p>
<p>別パッケージになっているので追加でインストールします。</p>
<pre><code>&gt; npm install --save prop-types</code></pre>
<p>ReactコンポーネントのpropTypesプロパティに型情報を記述します。 Functional Component/Class Componentのどちらでも記述できます。</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="im">import</span> PropTypes <span class="im">from</span> <span class="st">'prop-types'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"></a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="kw">const</span> Hello <span class="op">=</span> (props) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb39-4" data-line-number="4">  <span class="cf">return</span> <span class="op">&lt;</span>div<span class="op">&gt;</span>こんにちは、<span class="op">{</span><span class="va">props</span>.<span class="at">name</span><span class="op">}</span>さん&lt;/div<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="op">};</span></a>
<a class="sourceLine" id="cb39-6" data-line-number="6"></a>
<a class="sourceLine" id="cb39-7" data-line-number="7"><span class="co">// ここに型情報を書きます</span></a>
<a class="sourceLine" id="cb39-8" data-line-number="8"><span class="co">// ↓</span></a>
<a class="sourceLine" id="cb39-9" data-line-number="9"><span class="va">Hello</span>.<span class="at">propTypes</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb39-10" data-line-number="10">  <span class="dt">name</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">string</span>    <span class="co">// nameの型はstring</span></a>
<a class="sourceLine" id="cb39-11" data-line-number="11"><span class="op">}</span></a></code></pre></div>
<p>propTypesの種類</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="im">import</span> PropTypes <span class="im">from</span> <span class="st">'prop-types'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"></a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="kw">class</span> SomeComponent <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="op">}</span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"></a>
<a class="sourceLine" id="cb40-7" data-line-number="7"><span class="va">SomeComponent</span>.<span class="at">propTypes</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb40-8" data-line-number="8">  <span class="dt">someString</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">string</span><span class="op">,</span> <span class="co">// 文字列</span></a>
<a class="sourceLine" id="cb40-9" data-line-number="9">  <span class="dt">someNumber</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">number</span><span class="op">,</span> <span class="co">// 数値</span></a>
<a class="sourceLine" id="cb40-10" data-line-number="10">  <span class="dt">someBool</span><span class="op">:</span>   <span class="va">PropTypes</span>.<span class="at">bool</span><span class="op">,</span>   <span class="co">// 真偽値</span></a>
<a class="sourceLine" id="cb40-11" data-line-number="11">  <span class="dt">someArray</span><span class="op">:</span>  <span class="va">PropTypes</span>.<span class="at">array</span><span class="op">,</span>  <span class="co">// 配列</span></a>
<a class="sourceLine" id="cb40-12" data-line-number="12">  <span class="dt">someObject</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">object</span><span class="op">,</span> <span class="co">// オブジェクト</span></a>
<a class="sourceLine" id="cb40-13" data-line-number="13">  <span class="dt">someFunc</span><span class="op">:</span>   <span class="va">PropTypes</span>.<span class="at">func</span><span class="op">,</span>   <span class="co">// 関数</span></a>
<a class="sourceLine" id="cb40-14" data-line-number="14">  <span class="dt">someSymbol</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">symbol</span><span class="op">,</span> <span class="co">// シンボル</span></a>
<a class="sourceLine" id="cb40-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb40-16" data-line-number="16">  <span class="co">// 配列の中身を指定</span></a>
<a class="sourceLine" id="cb40-17" data-line-number="17">  <span class="dt">someArray2</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">arayOf</span>(<span class="va">PropTypes</span>.<span class="at">number</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb40-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb40-19" data-line-number="19">  <span class="co">// オブジェクトの中身を指定</span></a>
<a class="sourceLine" id="cb40-20" data-line-number="20">  <span class="dt">someObj2</span><span class="op">:</span>   <span class="va">PropTypes</span>.<span class="at">objectOf</span>(<span class="va">PropTypes</span>.<span class="at">number</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb40-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb40-22" data-line-number="22">  <span class="co">// オブジェクトの個別のプロパティの中身を指定</span></a>
<a class="sourceLine" id="cb40-23" data-line-number="23">  <span class="dt">someObj3</span><span class="op">:</span>   <span class="va">PropTypes</span>.<span class="at">shape</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb40-24" data-line-number="24">    <span class="dt">name</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">string</span><span class="op">,</span></a>
<a class="sourceLine" id="cb40-25" data-line-number="25">    <span class="dt">age</span><span class="op">:</span>  <span class="va">PropTypes</span>.<span class="at">number</span></a>
<a class="sourceLine" id="cb40-26" data-line-number="26">  <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb40-27" data-line-number="27">  </a>
<a class="sourceLine" id="cb40-28" data-line-number="28">  <span class="co">// Reactエレメント</span></a>
<a class="sourceLine" id="cb40-29" data-line-number="29">  <span class="dt">someElement</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">element</span><span class="op">,</span></a>
<a class="sourceLine" id="cb40-30" data-line-number="30">  </a>
<a class="sourceLine" id="cb40-31" data-line-number="31">  <span class="co">// コンポーネントの子要素となるもの</span></a>
<a class="sourceLine" id="cb40-32" data-line-number="32">  <span class="co">// （string, number, element, array ならOK）</span></a>
<a class="sourceLine" id="cb40-33" data-line-number="33">  <span class="dt">someNode</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">node</span><span class="op">,</span></a>
<a class="sourceLine" id="cb40-34" data-line-number="34">  </a>
<a class="sourceLine" id="cb40-35" data-line-number="35">  <span class="co">// Helloコンポーネントのインスタンスを指定</span></a>
<a class="sourceLine" id="cb40-36" data-line-number="36">  <span class="dt">helloElement</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">instanceOf</span>(Hello)<span class="op">,</span></a>
<a class="sourceLine" id="cb40-37" data-line-number="37">  </a>
<a class="sourceLine" id="cb40-38" data-line-number="38">  <span class="co">// 指定した値のいずれかであること</span></a>
<a class="sourceLine" id="cb40-39" data-line-number="39">  <span class="dt">dayOfTheWeek</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">oneOf</span>([<span class="st">&quot;月&quot;</span><span class="op">,</span> <span class="st">&quot;火&quot;</span><span class="op">,</span> <span class="st">&quot;水&quot;</span>])<span class="op">,</span></a>
<a class="sourceLine" id="cb40-40" data-line-number="40">  </a>
<a class="sourceLine" id="cb40-41" data-line-number="41">  <span class="co">// 配列で指定した型のいずれかであること</span></a>
<a class="sourceLine" id="cb40-42" data-line-number="42">  <span class="dt">union</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">oneOfType</span>([</a>
<a class="sourceLine" id="cb40-43" data-line-number="43">    <span class="va">PropTypes</span>.<span class="at">string</span><span class="op">,</span></a>
<a class="sourceLine" id="cb40-44" data-line-number="44">    <span class="va">PropTypes</span>.<span class="at">number</span><span class="op">,</span></a>
<a class="sourceLine" id="cb40-45" data-line-number="45">    <span class="va">PropTypes</span>.<span class="at">instanceOf</span>(Hello)<span class="op">,</span></a>
<a class="sourceLine" id="cb40-46" data-line-number="46">  ])<span class="op">,</span></a>
<a class="sourceLine" id="cb40-47" data-line-number="47">  </a>
<a class="sourceLine" id="cb40-48" data-line-number="48">  <span class="co">// 何でもオーケー</span></a>
<a class="sourceLine" id="cb40-49" data-line-number="49">  <span class="dt">any</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="at">any</span><span class="op">,</span></a>
<a class="sourceLine" id="cb40-50" data-line-number="50">  </a>
<a class="sourceLine" id="cb40-51" data-line-number="51">  <span class="co">// 必須項目</span></a>
<a class="sourceLine" id="cb40-52" data-line-number="52">  <span class="dt">requiredString</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="va">string</span>.<span class="at">isRequired</span><span class="op">,</span></a>
<a class="sourceLine" id="cb40-53" data-line-number="53">  </a>
<a class="sourceLine" id="cb40-54" data-line-number="54">  <span class="co">// どんな型でもいいから何かしら指定</span></a>
<a class="sourceLine" id="cb40-55" data-line-number="55">  <span class="dt">requiredAny</span><span class="op">:</span> <span class="va">PropTypes</span>.<span class="va">any</span>.<span class="at">isRequired</span><span class="op">,</span></a>
<a class="sourceLine" id="cb40-56" data-line-number="56"><span class="op">};</span></a>
<a class="sourceLine" id="cb40-57" data-line-number="57"></a>
<a class="sourceLine" id="cb40-58" data-line-number="58"><span class="co">// propsの値が undefined だったときの規定値を指定する</span></a>
<a class="sourceLine" id="cb40-59" data-line-number="59"><span class="va">SomeComponent</span>.<span class="at">defaultProps</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb40-60" data-line-number="60">  <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;坂本竜馬&quot;</span>    <span class="co">// name が undefined のときに設定する内容</span></a>
<a class="sourceLine" id="cb40-61" data-line-number="61"><span class="op">};</span></a></code></pre></div>
<dl>
<dt><code>Array.map</code>メソッド</dt>
<dd><p>配列の各要素について、引数に与えられた関数の処理に従って処理をし、新たな配列を返すメソッド。</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="co">// tasksの各要素をTodoItemコンポーネントにして返す</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw">const</span> list <span class="op">=</span> <span class="kw">this</span>.<span class="va">props</span>.<span class="va">tasks</span>.<span class="at">map</span>(todo <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb41-3" data-line-number="3">  <span class="cf">return</span> <span class="op">&lt;</span>TodoItem <span class="op">{</span>...<span class="at">todo</span><span class="op">}</span> key<span class="op">={</span><span class="va">todo</span>.<span class="at">id</span><span class="op">}</span> /&gt;<span class="op">;</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
</dd>
</dl>
<h3>stateの初期値</h3>
<p><code>constructor</code>で設定します。</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="at">constructor</span>(props) <span class="op">{</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2">  <span class="kw">super</span>(props)<span class="op">;</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3">  <span class="kw">this</span>.<span class="at">state</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb42-4" data-line-number="4">    <span class="dt">tasks</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb42-5" data-line-number="5">      <span class="op">{</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Todo-1&quot;</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="dv">0</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb42-6" data-line-number="6">      <span class="op">{</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Todo-2&quot;</span><span class="op">,</span> <span class="dt">id</span><span class="op">:</span> <span class="dv">1</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb42-7" data-line-number="7">    ]<span class="op">,</span></a>
<a class="sourceLine" id="cb42-8" data-line-number="8">    <span class="dt">uniqueId</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></a>
<a class="sourceLine" id="cb42-9" data-line-number="9">  <span class="op">};</span></a>
<a class="sourceLine" id="cb42-10" data-line-number="10"><span class="op">}</span></a></code></pre></div>
<ul>
<li><code>state</code>の名前は変更できません。</li>
<li><code>this.state</code>に直接値を入れていいのは<code>constructor</code>で初期値を設定するときだけです。 それ以外の場面で直接編集してしまうと、Reactコンポーネントに値の変更を通知することができません。</li>
<li><code>this.state</code>を更新するときは<code>this.setState</code>メソッドを使います。 いまあるstateと比べて、変更があった内容を反映します。stateをごっそり置き換えるわけではありません。</li>
<li><code>this.state</code>を直接参照するのはありです。</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="at">constructor</span>(props) <span class="op">{</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2">  ...略</a>
<a class="sourceLine" id="cb43-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb43-4" data-line-number="4">  <span class="co">// bindメソッド</span></a>
<a class="sourceLine" id="cb43-5" data-line-number="5">  <span class="co">// 指定したメソッドでAppコンポーネントのstateを変更するために必要</span></a>
<a class="sourceLine" id="cb43-6" data-line-number="6">  <span class="co">// ↓</span></a>
<a class="sourceLine" id="cb43-7" data-line-number="7">  <span class="kw">this</span>.<span class="at">methodName</span> <span class="op">=</span> <span class="kw">this</span>.<span class="va">methodName</span>.<span class="at">bind</span>(<span class="kw">this</span>)<span class="op">;</span></a></code></pre></div>
<dl>
<dt><code>bind</code>メソッド</dt>
<dd><p>関数の中で使用する<code>this</code>を強制する（バインドする）メソッド。</p>
<p>methodNameメソッドを実行するのは、Appコンポーネントではない別のコンポーネントやDOMになります。 それらのコンテキストである<code>this</code>には<code>state</code>が存在しないのでエラーが発生します。</p>
</dd>
</dl>
<p>ほかのバインドの方法</p>
<ul>
<li><p>アロー関数を使う</p>
<p>アロー関数を使うときは、constructorにbindメソッドを書く必要がありません。 ですが、同じメソッドを複数のコンポーネントに渡したい場合、その数だけアロー関数を書く必要があります。</p>
<p>毎回新しいアロー関数を作ることになるので、パフォーマンスも少し劣ります。</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="co">// アロー関数を使う</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="op">&lt;</span>Component methodName<span class="op">={</span> (hoge) <span class="op">=&gt;</span> <span class="op">{</span> <span class="kw">this</span>.<span class="at">methodName</span>(hoge) <span class="op">}</span> <span class="op">}</span> /&gt;</a></code></pre></div></li>
<li><p>property initializer syntax を使う</p>
<p>最初からバインドされたメソッドを作ることができます。 アロー関数のようなパフォーマンスの懸念もありません。</p>
<p>ただし、ECMAScriptに公式なシンタックスとして採用されていないため、babelにプラグインを追加しておく必要があります。</p>
<p>Class properties transform・Babel（transform-class-properties）</p></li>
</ul>
<h3>イベントハンドリング</h3>
<p>イベントハンドラを追加します。</p>
<p>下記の例では、クリック時のイベントを<code>handleClick</code>メソッドに定義しています。 イベントとの関連付けは、button要素のonClick属性に<code>handleClick</code>メソッドを設定しています。</p>
<p>Reactでは<code>onClick</code>といった属性に関数を渡して、イベントの関連付けをします。</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="at">constructor</span>(props) <span class="op">{</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2">  <span class="kw">super</span>(props)<span class="op">;</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3">  <span class="kw">this</span>.<span class="at">handleClick</span> <span class="op">=</span> <span class="kw">this</span>.<span class="va">handleClick</span>.<span class="at">bind</span>(<span class="kw">this</span>)<span class="op">;</span>   <span class="co">// バインドする</span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="op">}</span></a>
<a class="sourceLine" id="cb45-5" data-line-number="5"><span class="co">// Eventオブジェクトを引数に持つ</span></a>
<a class="sourceLine" id="cb45-6" data-line-number="6"><span class="at">handleClick</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb45-7" data-line-number="7">  <span class="kw">this</span>.<span class="va">props</span>.<span class="at">methodName</span>(<span class="st">&quot;hoge&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb45-8" data-line-number="8"><span class="op">}</span></a>
<a class="sourceLine" id="cb45-9" data-line-number="9"><span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb45-10" data-line-number="10">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb45-11" data-line-number="11">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb45-12" data-line-number="12">      <span class="op">&lt;</span>input placeholder<span class="op">=</span><span class="st">&quot;何か入力してください&quot;</span> /&gt;</a>
<a class="sourceLine" id="cb45-13" data-line-number="13">      <span class="op">&lt;</span>button onClick<span class="op">={</span> <span class="kw">this</span>.<span class="at">handleClick</span> <span class="op">}</span> <span class="op">&gt;</span>登録&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb45-14" data-line-number="14">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb45-15" data-line-number="15"><span class="op">}</span></a></code></pre></div>
<p>イベントハンドラの引数は、Eventオブジェクトを受け取ります。 ブラウザ本来のEventオブジェクトとほぼ同じものです。</p>
<h3>formの操作</h3>
<p>Reactではフォームに入力された値も<code>state</code>として扱います。</p>
<p>以下は、ユーザーの入力で state を変更するコードです。</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="at">constructor</span>(props) <span class="op">{</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2">  <span class="kw">super</span>(props)<span class="op">;</span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3">  <span class="kw">this</span>.<span class="at">state</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb46-4" data-line-number="4">    <span class="dt">inputValue</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb46-5" data-line-number="5">  <span class="op">};</span></a>
<a class="sourceLine" id="cb46-6" data-line-number="6">  <span class="kw">this</span>.<span class="at">handleChange</span> <span class="op">=</span> <span class="kw">this</span>.<span class="va">handleChange</span>.<span class="at">bind</span>(<span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb46-7" data-line-number="7">  <span class="kw">this</span>.<span class="at">handleClick</span> <span class="op">=</span> <span class="kw">this</span>.<span class="va">handleClick</span>.<span class="at">bind</span>(<span class="kw">this</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb46-8" data-line-number="8"><span class="op">}</span></a>
<a class="sourceLine" id="cb46-9" data-line-number="9"><span class="at">handleChange</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb46-10" data-line-number="10">  <span class="co">// ユーザーの入力した値をstate.inputValueに格納する</span></a>
<a class="sourceLine" id="cb46-11" data-line-number="11">  <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb46-12" data-line-number="12">    <span class="dt">inputValue</span><span class="op">:</span> <span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span><span class="op">,</span></a>
<a class="sourceLine" id="cb46-13" data-line-number="13">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb46-14" data-line-number="14"><span class="op">}</span></a>
<a class="sourceLine" id="cb46-15" data-line-number="15"><span class="at">handleClick</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb46-16" data-line-number="16">  <span class="kw">const</span> inputValue <span class="op">=</span> <span class="kw">this</span>.<span class="va">state</span>.<span class="at">inputValue</span><span class="op">;</span></a>
<a class="sourceLine" id="cb46-17" data-line-number="17">  <span class="kw">this</span>.<span class="va">props</span>.<span class="at">methodName</span>(inputValue)<span class="op">;</span></a>
<a class="sourceLine" id="cb46-18" data-line-number="18"><span class="op">}</span></a>
<a class="sourceLine" id="cb46-19" data-line-number="19"><span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb46-20" data-line-number="20">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb46-21" data-line-number="21">    <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;TodoInput&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb46-22" data-line-number="22">      ▼valueに<span class="va">state</span>.<span class="at">inputValue</span>を設定、onChangeにhandleChangeメソッドを関連付け</a>
<a class="sourceLine" id="cb46-23" data-line-number="23">      <span class="op">&lt;</span>input placeholder<span class="op">=</span><span class="st">&quot;何か入力してください&quot;</span> value<span class="op">={</span><span class="kw">this</span>.<span class="va">state</span>.<span class="at">inputValue</span><span class="op">}</span> onChange<span class="op">={</span><span class="kw">this</span>.<span class="at">handleChange</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb46-24" data-line-number="24">      <span class="op">&lt;</span>button onClick<span class="op">={</span><span class="kw">this</span>.<span class="at">handleClick</span><span class="op">}</span> <span class="op">&gt;</span>登録&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb46-25" data-line-number="25">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb46-26" data-line-number="26">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb46-27" data-line-number="27"><span class="op">}</span></a></code></pre></div>
<h3>まとめ: Reactコンポーネントの作成手順</h3>
<ol>
<li>UIをコンポーネントに分割する</li>
<li>propsやstateによって、どのようにUIが変化するかを定義する（JSXの作成）</li>
<li>ユーザー操作によって、どのようにstateが変化するかを定義する（メソッドの作成）</li>
<li>UIとメソッドを関連付ける（onClick属性などを設定）</li>
</ol>
<p>コンポーネントごとの責務を明らかにすること。</p>
<h3>ライフサイクル</h3>
<p>Reactコンポーネントにはライフサイクルメソッドと呼ばれる特殊なメソッドがあります。 Reactコンポーネントの状態に応じて、次の3つのうち対応するメソッドが呼ばれます。</p>
<ul>
<li>コンポーネントのマウントに対応して呼ばれるメソッド。</li>
<li>コンポーネントで扱うデータの変化に対応して呼ばれるメソッド。</li>
<li>エラーハンドリングに用いるメソッド。</li>
</ul>
<h4>マウントに関するライフサイクルメソッド</h4>
<p>Reactコンポーネントが新しく配置されるときに呼び出されるメソッドです。 コンポーネントの<code>render</code>メソッドが初めて呼ばれたときに、コンポーネントがマウントされた状態となります。</p>
<ul>
<li>コンポーネントのマウント ＝ コンポーネントの<code>render</code>メソッドが初めて呼ばれたとき</li>
<li>コンポーネントのアップデート ＝ 2回目以降の<code>render</code>メソッドの呼び出し</li>
<li>コンポーネントのアンマウント ＝ DOM上からなくなったとき</li>
</ul>
<dl>
<dt>componentWillMount</dt>
<dd><p>コンポーネントがマウントされる直前に呼ばれます。 コンポーネントを描画する<code>render</code>メソッドよりも先に呼ばれます。</p>
<p>ただ、コンストラクターも<code>render</code>メソッドより先に呼ばれるので、マウント前にしたい処理はここではなくコンストラクターで実行すれば十分です。</p>
</dd>
<dt>componentDidMount</dt>
<dd><p>コンポーネントがマウントされた直後に呼ばれます。 DOMがブラウザにレンダリングされたあとなので、DOMに対してイベントリスナーを設定したりサブスクライブなどの処理をしたりします。</p>
<p>TODO: サブスクライブって何でしょう？？</p>
<p><code>setState</code>は行わないこと。</p>
<p>stateが変更されるとrenderメソッドが実行されます。 render → componentDidMount → setState → renderとなり、renderメソッドが2回実行されてしまうためです。</p>
</dd>
<dt>componentWillUnmount</dt>
<dd><p>コンポーネントがアンマウントされる直前に呼ばれます。 各種コンポーネントに関連付けた処理の後始末をします。</p>
<p>たとえば、setInterval関数に対するclearIntervalの実行や、APIリクエストのキャンセルなどです。</p>
</dd>
</dl>
<h4>データのアップデートに関するライフサイクルメソッド</h4>
<p>アップデートはコンポーネントのpropsかstateが変更されたときに行われます。 初回のレンダリングはマウントとして扱われるため、マウント時にはこれらのメソッドは実行されません。</p>
<dl>
<dt>componentWillReceiveProps</dt>
<dd><p>引数に受け取る予定のpropsをとります。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="at">componentWillReceiveProps</span>(nextProps)</a></code></pre></div>
<p>propsがアップデートされようとしているときのみ実行されます。 propsの受け取りで実行されるため、変更の有無は関係なく実行されます。</p>
<p>this.propsには以前に受け取ったpropsが入っています。 引数のnextPropsと比較する処理をすることができます。</p>
<p>setStateをすることも可能です。</p>
</dd>
<dt>shouldComponentUpdate</dt>
<dd><p>propsやstateに変更が合った場合に呼ばれます。 引数は次に受け取るpropsとstateです。 this.propsとthis.stateには前回の内容が入っています。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="at">shouldComponentUpdate</span>(nextProps<span class="op">,</span> nextStaet)</a></code></pre></div>
<p>renderを行うべきかどうかをtrue/falseで返す必要があります。</p>
<p>このメソッドを指定しなかった場合、どのような変更でもrenderメソッドが呼び出されます（常にtrueを返すように指定したのと同じ）。</p>
<p>このメソッドはパフォーマンスチューニングをする際に利用します。 表示に使っていないpropを受け取ったときや、そもそもpropsやstateに変更がなかったときは不要なrenderを行わないようにします。</p>
<p>変更がないpropやstateを受け取ったときに再描画させないようにするもう一つの方法。</p>
<p><code>React.Component</code>を継承する代わりに<code>React.PureComponent</code>を継承すると、Reactが自動的に浅い比較（オブジェクトや配列の中身までは確認しない比較）を行うので、通常はこちらを利用する方が便利です。 なにか特別な比較を行い、renderの有無を決めるときだけ<code>shouldComponentUpdate</code>を利用することを推奨します。</p>
</dd>
<dt>componentWillUpdate</dt>
<dd><p>renderが呼ばれる前に呼ばれる最後のメソッドです。</p>
<p>引数は次に受け取るpropsとstateです。 this.propsとthis.stateには前回の内容が入っています。</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="at">componentWillUpdate</span>(nextProps<span class="op">,</span> nextStaet)</a></code></pre></div>
<p><code>setState</code>などコンポーネントの再レンダリングを促すような処理はしないこと。 変更に対して<code>componentWillUpdate</code>、<code>render</code>が実行され、処理がループする可能性があるためです。</p>
<p>propsの値を使ってstateを変更したいときは<code>componentWillReceiveProps</code>メソッドを使います。</p>
<p><code>shouldComponentUpdate</code>でfalseを返した場合、このメソッドは呼ばれません。</p>
</dd>
<dt>componentDidUpdate</dt>
<dd><p>renderの直後に呼ばれます。</p>
<p>引数は前のpropsとstateです。 this.propsとthis.stateは、いまの値（renderに使った内容）が格納されています。</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="at">componentDidUpdate</span>(prevProps<span class="op">,</span> prevStaet)</a></code></pre></div>
<p>アップデート後のDOMにアクセスするときや、変更が完了したことをAPIに通知するときなどに利用します。</p>
<p><code>shouldComponentUpdate</code>でfalseを返した場合、このメソッドは呼ばれません。</p>
</dd>
</dl>
<h4>エラーハンドリングに関するライフサイクルメソッド</h4>
<p>エラーが起きたときだけ呼ばれるライフサイクルメソッドです。 React v16 から実装されています。</p>
<dl>
<dt>componentDidCatch</dt>
<dd><p>子コンポーネントでエラーが起こったときに呼ばれます。</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="at">componentDidCatch</span>(error<span class="op">,</span> info)</a></code></pre></div>
<p>引数にスタックとレースが入ったerror、その他の情報が入ったinfoをとります。</p>
<p>infoはオブジェクトで、現時点では<code>componentStack</code>プロパティしか持っていません。 これにはどのコンポーネントでエラーが発生したかが入っています。</p>
<p>エラー解析の手がかりとなるので、どちらもログとして送信するようにしておくと便利。</p>
<p><code>setState</code>などの処理を行うことも可能。</p>
<p>このメソッドを記述したコンポーネント自体のエラーは検知できません。 子コンポーネントのエラーを検知するためのメソッドです。</p>
</dd>
</dl>
<h2>Reduxによるアプリケーションの状態管理</h2>
<p><code>create-react-app</code>で新しいアプリケーションを作成します。</p>
<h3>Reduxのインストール</h3>
<pre><code>&gt; npm install --save redux</code></pre>
<h3>Reduxの構成</h3>
<dl>
<dt>Store</dt>
<dd>アプリケーションの状態（<code>state</code>）とロジックを保持している居場所。
</dd>
<dt>Reducer</dt>
<dd>Storeが保持している状態を変化させるための関数。
</dd>
<dt>Action</dt>
<dd><p>何らかの状態変化を引き起こす現象。たとえば、ユーザー入力、APIから取得した情報。</p>
<p>Actionの形式を標準化した〝Flux Standard Action〟というものがあります。 Actionを扱うライブラリ（<code>redux-actions</code>や<code>redux-promise</code>など）でも、これを採用したものが多いので、この形式に沿っておくのがよいでしょう。</p>
<p>Actionオブジェクトには、次のプロパティを持たせることができます。</p>
<ul>
<li><p>type</p>
<p>必須プロパティです。 どのような操作をしたのかが分かる内容を指定します。</p></li>
<li><p>payload</p>
<p>Actionに伴うデータ。オブジェクト形式で扱うのが一般的。 errorプロパティがtrueのときはErrorオブジェクトを返すべき。</p></li>
<li><p>error</p>
<p>エラーを表現するときはtrueにします。</p></li>
<li><p>meta</p>
<p>payloadとは別に、ほかの情報をActionとして含めたいときに使う項目です。</p></li>
</ul>
</dd>
</dl>
<h3>Reducerの定義</h3>
<p>Storeの初期状態［index.js］</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw">const</span> initialState <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb53-2" data-line-number="2">  <span class="dt">tasks</span><span class="op">:</span> []</a>
<a class="sourceLine" id="cb53-3" data-line-number="3"><span class="op">};</span></a></code></pre></div>
<p>tasksReducerの定義［index.js］</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="co">// Reducerの定義</span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="co">// 第1引数は、現在の状態を表すstateオブジェクト</span></a>
<a class="sourceLine" id="cb54-3" data-line-number="3"><span class="co">// 第2引数は、どのような操作をしたのかを示すActionオブジェクト</span></a>
<a class="sourceLine" id="cb54-4" data-line-number="4"><span class="kw">function</span> <span class="at">tasksReducer</span>(state <span class="op">=</span> initialState<span class="op">,</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb54-5" data-line-number="5">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb54-6" data-line-number="6">    <span class="cf">case</span> <span class="st">'ADD_TASK'</span><span class="op">:</span></a>
<a class="sourceLine" id="cb54-7" data-line-number="7">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb54-8" data-line-number="8">        ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb54-9" data-line-number="9">        <span class="dt">tasks</span><span class="op">:</span> <span class="va">state</span>.<span class="va">tasks</span>.<span class="at">concat</span>([<span class="va">action</span>.<span class="at">task</span>])    <span class="co">// </span><span class="al">TODO</span><span class="co">: action.payload.taskでは？　→　そのとおりでした。</span></a>
<a class="sourceLine" id="cb54-10" data-line-number="10">      <span class="op">};</span></a>
<a class="sourceLine" id="cb54-11" data-line-number="11">    <span class="dt">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb54-12" data-line-number="12">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb54-13" data-line-number="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb54-14" data-line-number="14"><span class="op">}</span></a></code></pre></div>
<p>Actionオブジェクトのイメージ</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2">  <span class="dt">type</span><span class="op">:</span> <span class="st">'ADD_TASK'</span><span class="op">,</span></a>
<a class="sourceLine" id="cb55-3" data-line-number="3">  <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb55-4" data-line-number="4">    <span class="dt">task</span><span class="op">:</span> <span class="st">'Study Reducer'</span></a>
<a class="sourceLine" id="cb55-5" data-line-number="5">  <span class="op">}</span></a>
<a class="sourceLine" id="cb55-6" data-line-number="6"><span class="op">}</span></a></code></pre></div>
<h3>ActionCreatorの定義</h3>
<p>ActionCreateとはActionを生成するための関数です。</p>
<p>Actionを生成する関数の定義［index.js］</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="co">// ActionCreatorの定義</span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="co">// 追加するtaskを引数に取り、Actionオブジェクトを返す</span></a>
<a class="sourceLine" id="cb56-3" data-line-number="3"><span class="kw">const</span> addTask <span class="op">=</span> (task) <span class="op">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb56-4" data-line-number="4">  <span class="dt">type</span><span class="op">:</span> <span class="st">'ADD_TASK'</span><span class="op">,</span></a>
<a class="sourceLine" id="cb56-5" data-line-number="5">  <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb56-6" data-line-number="6">    task</a>
<a class="sourceLine" id="cb56-7" data-line-number="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb56-8" data-line-number="8"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<h3>Storeの定義</h3>
<p>Reduxの<code>createStore</code>関数を使ってStoreを生成します。 生成したStoreはアプリケーション内で唯一のものです。 アプリケーション全体のさまざまな状態をこのStoreで集約管理します。</p>
<p>ReduxのStoreを生成するにはReducerが必要となります。</p>
<p>Storeの作成［index.js］</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">'redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb57-2" data-line-number="2"></a>
<a class="sourceLine" id="cb57-3" data-line-number="3"><span class="co">// Reducerの定義</span></a>
<a class="sourceLine" id="cb57-4" data-line-number="4"><span class="kw">function</span> <span class="at">tasksReducer</span>(state <span class="op">=</span> initialState<span class="op">,</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb57-5" data-line-number="5">  <span class="co">// ...略</span></a>
<a class="sourceLine" id="cb57-6" data-line-number="6"><span class="op">}</span></a>
<a class="sourceLine" id="cb57-7" data-line-number="7"></a>
<a class="sourceLine" id="cb57-8" data-line-number="8"><span class="co">// Storeの生成</span></a>
<a class="sourceLine" id="cb57-9" data-line-number="9"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(tasksReducer)<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="at">createStore</span>(reducer<span class="op">,</span> [preloadedState]<span class="op">,</span> [enhancer])</a></code></pre></div>
<p>引数</p>
<dl>
<dt>reducer</dt>
<dd>Reducerを指定します。
</dd>
<dt>preloadedState</dt>
<dd>Storeの初期値を指定します。 サーバーサイドやユーザーセッションで事前にデータを保持しているときに利用することが想定されます。
</dd>
<dt>enhancer</dt>
<dd>Storeの機能を拡張するサードパーティ製のツールを指定できます。
</dd>
</dl>
<p>戻り値</p>
<p>Storeオブジェクト</p>
<p>Storeオブジェクトは次の4つのメソッドを持ちます。</p>
<ul>
<li><p>dispatch</p>
<p>ActionCreatorで生成したActionを発行します。</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="co">// ActionCreatorの定義</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2"><span class="kw">const</span> addTask <span class="op">=</span> (task) <span class="op">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb59-3" data-line-number="3">  ... 略</a>
<a class="sourceLine" id="cb59-4" data-line-number="4"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb59-5" data-line-number="5"></a>
<a class="sourceLine" id="cb59-6" data-line-number="6"><span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addTask</span>(<span class="st">&quot;Study Store&quot;</span>))<span class="op">;</span></a></code></pre></div></li>
<li><p>getState</p>
<p>Storeの現在の状態を取得します。</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb60-2" data-line-number="2">↓</a>
<a class="sourceLine" id="cb60-3" data-line-number="3"><span class="op">{</span></a>
<a class="sourceLine" id="cb60-4" data-line-number="4">  <span class="dt">tasks</span><span class="op">:</span> [<span class="st">'Study Store'</span>]</a>
<a class="sourceLine" id="cb60-5" data-line-number="5"><span class="op">}</span></a></code></pre></div></li>
<li><p>subscribe</p>
<p>Storeの状態が変更されたときに呼び出されるコールバック関数を指定します。</p>
<p>ActionのdispatchによってStoreの状態が変わったときに、その変換を監視する役目を担う処理。</p>
<p><code>store.subscribe</code>で監視を開始します。 <code>store.subscribe</code>の戻り値である<code>unsubscribe</code>を実行することで、<code>subscribe</code>を解除することができます。</p>
<p>実際にReactと組み合わせるときは、<code>react-redux</code>というライブラリを使います。 <code>react-redux</code>が<code>subscribe</code>の仕組みを隠蔽するため、Storeの状態が変化するとReactのViewが更新されるというシンプルな流れになります。</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb61-1" data-line-number="1"><span class="kw">function</span> <span class="at">handleChange</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2">  <span class="va">console</span>.<span class="at">log</span>(<span class="va">store</span>.<span class="at">getState</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb61-3" data-line-number="3"><span class="op">}</span></a>
<a class="sourceLine" id="cb61-4" data-line-number="4"></a>
<a class="sourceLine" id="cb61-5" data-line-number="5"><span class="co">// Storeの状態が変化したときに handleChange 関数が呼ばれる。</span></a>
<a class="sourceLine" id="cb61-6" data-line-number="6"><span class="co">// subscribeの戻り値は unsubscribe という関数。</span></a>
<a class="sourceLine" id="cb61-7" data-line-number="7"><span class="co">// これを実行すると状態変化の通知が解除され、handleChange 関数は呼ばれなくなる。</span></a>
<a class="sourceLine" id="cb61-8" data-line-number="8"><span class="kw">const</span> unsubscribe <span class="op">=</span> <span class="va">store</span>.<span class="at">subscribe</span>(handleChange)<span class="op">;</span></a></code></pre></div></li>
<li><p>replaceReducer</p>
<p>createStoreで関連付けたReducerを、別のReducerに差し替えるメソッドです。</p>
<p>createStoreで関連付けることができるReducerは1つだけです。 複数あるReducerを動的にロードしたいときにこのメソッドで差し替えをします。</p>
<p>Storeに関連付けられているReducerのみしか適用されないので、特別な理由がない限り、combineReducerによって一つにまとめたReducerを関連付けてしまう方が楽。</p>
<dl>
<dt>combineReducer</dt>
<dd><p>Reduxに備わっているメソッドで、複数のReducerを合成します。</p>
<p>通常、一つのReducer内で処理分岐して定義して問題ありませんが、規模が大きくなってくると見通しが悪くなってくるのでReducerを分割したくなります。 そんなときにどうぞ。</p>
<p>Storeはアプリケーション内で一つということに変わりはありませんが、Reducerを分割することで、Storeを擬似的に分割できる点がメリットです。</p>
</dd>
</dl></li>
</ul>
<h3>Reactと組み合わせる</h3>
<p>次の機能を持たせます。</p>
<ul>
<li>Reactを使って状態の変化をViewに反映する。</li>
<li>ブラウザからのタスク入力を可能にする。</li>
</ul>
<ol>
<li><p>タスク入力用のActionCreatorの定義</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="co">// タスク入力用のActionCreator</span></a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="kw">const</span> inputTask <span class="op">=</span> (task) <span class="op">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3">  <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;INPUT_TASK&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb62-4" data-line-number="4">  <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb62-5" data-line-number="5">    task</a>
<a class="sourceLine" id="cb62-6" data-line-number="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb62-7" data-line-number="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div></li>
<li><p>タスク入力用のActionを受け取りStoreを変更できるように、Reducerを変更する</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw">const</span> initialState <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-2" data-line-number="2">  <span class="dt">task</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span>       <span class="co">// ←追加</span></a>
<a class="sourceLine" id="cb63-3" data-line-number="3">  <span class="dt">tasks</span><span class="op">:</span> []</a>
<a class="sourceLine" id="cb63-4" data-line-number="4"><span class="op">};</span></a>
<a class="sourceLine" id="cb63-5" data-line-number="5"></a>
<a class="sourceLine" id="cb63-6" data-line-number="6"><span class="kw">function</span> <span class="at">tasksReducer</span>(state <span class="op">=</span> initialState<span class="op">,</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb63-7" data-line-number="7">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb63-8" data-line-number="8">    <span class="cf">case</span> <span class="st">'INPUT_TASK'</span><span class="op">:</span>    <span class="co">// INPUT_TASKのCaseを追加</span></a>
<a class="sourceLine" id="cb63-9" data-line-number="9">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-10" data-line-number="10">        ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb63-11" data-line-number="11">        <span class="dt">task</span><span class="op">:</span> <span class="va">action</span>.<span class="va">payload</span>.<span class="at">task</span></a>
<a class="sourceLine" id="cb63-12" data-line-number="12">      <span class="op">};</span></a>
<a class="sourceLine" id="cb63-13" data-line-number="13">    <span class="cf">case</span> <span class="st">'ADD_TASK'</span><span class="op">:</span></a>
<a class="sourceLine" id="cb63-14" data-line-number="14">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-15" data-line-number="15">        ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb63-16" data-line-number="16">        <span class="dt">tasks</span><span class="op">:</span> <span class="va">state</span>.<span class="va">tasks</span>.<span class="at">concat</span>([<span class="va">action</span>.<span class="va">payload</span>.<span class="at">task</span>])</a>
<a class="sourceLine" id="cb63-17" data-line-number="17">      <span class="op">};</span></a>
<a class="sourceLine" id="cb63-18" data-line-number="18">    <span class="dt">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb63-19" data-line-number="19">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb63-20" data-line-number="20">  <span class="op">}</span></a>
<a class="sourceLine" id="cb63-21" data-line-number="21"><span class="op">}</span></a></code></pre></div></li>
<li><p>Reactコンポーネントの定義を追加する</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">function</span> <span class="at">TodoApp</span>(<span class="op">{</span> store <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb64-2" data-line-number="2">  <span class="kw">const</span> <span class="op">{</span> task<span class="op">,</span> tasks <span class="op">}</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb64-3" data-line-number="3">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb64-4" data-line-number="4">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb64-5" data-line-number="5">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> onChange<span class="op">={</span>(e) <span class="op">=&gt;</span> <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">inputTask</span>(<span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span>))<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb64-6" data-line-number="6">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;button&quot;</span> value<span class="op">=</span><span class="st">&quot;add&quot;</span> onClick<span class="op">={</span>() <span class="op">=&gt;</span> <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addTask</span>(task))<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb64-7" data-line-number="7">      <span class="op">&lt;</span>ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb64-8" data-line-number="8">        <span class="op">{</span></a>
<a class="sourceLine" id="cb64-9" data-line-number="9">          <span class="va">tasks</span>.<span class="at">map</span>(<span class="kw">function</span>(item<span class="op">,</span> i) <span class="op">{</span></a>
<a class="sourceLine" id="cb64-10" data-line-number="10">            <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb64-11" data-line-number="11">              <span class="op">&lt;</span>li key<span class="op">={</span>i<span class="op">}&gt;{</span>item<span class="op">}</span>&lt;/li<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb64-12" data-line-number="12">            )<span class="op">;</span></a>
<a class="sourceLine" id="cb64-13" data-line-number="13">          <span class="op">}</span>)</a>
<a class="sourceLine" id="cb64-14" data-line-number="14">        <span class="op">}</span></a>
<a class="sourceLine" id="cb64-15" data-line-number="15">      &lt;/ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb64-16" data-line-number="16">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb64-17" data-line-number="17">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb64-18" data-line-number="18"><span class="op">}</span></a></code></pre></div></li>
<li><p>Reactコンポーネントを描画する関数の準備</p>
<p>importを次のように変更する。</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">'react-dom'</span><span class="op">;</span></a></code></pre></div>
<p>↓</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="im">import</span> <span class="op">{</span> render <span class="op">}</span> <span class="im">from</span> <span class="st">'react-dom'</span><span class="op">;</span></a></code></pre></div>
<p>Viewを描画する関数を追加する。</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="kw">function</span> <span class="at">renderApp</span>(store) <span class="op">{</span></a>
<a class="sourceLine" id="cb67-2" data-line-number="2">  <span class="at">render</span>(</a>
<a class="sourceLine" id="cb67-3" data-line-number="3">    <span class="op">&lt;</span>TodoApp store<span class="op">={</span>store<span class="op">}</span> /&gt;<span class="op">,</span></a>
<a class="sourceLine" id="cb67-4" data-line-number="4">    <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'root'</span>)</a>
<a class="sourceLine" id="cb67-5" data-line-number="5">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb67-6" data-line-number="6"><span class="op">}</span></a></code></pre></div>
<p>もともとあった描画の処理は削除する。</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="va">ReactDOM</span>.<span class="at">render</span>(<span class="op">&lt;</span>App /<span class="op">&gt;,</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'root'</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb68-2" data-line-number="2"><span class="at">registerServiceWorker</span>()<span class="op">;</span></a></code></pre></div></li>
<li><p>Viewに反映する関数の準備</p>
<p>Storeの状態変化に応じてViewを変化させる関数を定義します。 Storeの<code>subscribe</code>メソッドを使います。</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="va">store</span>.<span class="at">subscribe</span>(() <span class="op">=&gt;</span> <span class="at">renderApp</span>(store))<span class="op">;</span></a></code></pre></div>
<p>上記処理の次に描画する関数の呼び出しを追加する。<br />
初期表示用？</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="at">renderApp</span>(store)<span class="op">;</span></a></code></pre></div></li>
</ol>
<h3>index.jsの全体</h3>
<div class="sourceCode" id="cb71"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2"><span class="im">import</span> <span class="op">{</span> render <span class="op">}</span> <span class="im">from</span> <span class="st">'react-dom'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb71-3" data-line-number="3"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">'redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb71-4" data-line-number="4"></a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="co">// Note: 使わないのでコメント化 &gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb71-6" data-line-number="6"><span class="co">// import './index.css';</span></a>
<a class="sourceLine" id="cb71-7" data-line-number="7"><span class="co">// import App from './App';</span></a>
<a class="sourceLine" id="cb71-8" data-line-number="8"><span class="co">// import registerServiceWorker from './registerServiceWorker';</span></a>
<a class="sourceLine" id="cb71-9" data-line-number="9"><span class="co">/// Note: &lt;&lt;&lt; 使わないのでコメント化</span></a>
<a class="sourceLine" id="cb71-10" data-line-number="10"></a>
<a class="sourceLine" id="cb71-11" data-line-number="11"><span class="kw">const</span> initialState <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb71-12" data-line-number="12">  <span class="dt">task</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb71-13" data-line-number="13">  <span class="dt">tasks</span><span class="op">:</span> []</a>
<a class="sourceLine" id="cb71-14" data-line-number="14"><span class="op">};</span></a>
<a class="sourceLine" id="cb71-15" data-line-number="15"></a>
<a class="sourceLine" id="cb71-16" data-line-number="16"><span class="co">// Reducerの定義</span></a>
<a class="sourceLine" id="cb71-17" data-line-number="17"><span class="co">// 第1引数は、現在の状態を表すstateオブジェクト</span></a>
<a class="sourceLine" id="cb71-18" data-line-number="18"><span class="co">// 第2引数は、どのような操作をしたのかを示すActionオブジェクト</span></a>
<a class="sourceLine" id="cb71-19" data-line-number="19"><span class="kw">function</span> <span class="at">tasksReducer</span>(state <span class="op">=</span> initialState<span class="op">,</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb71-20" data-line-number="20">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb71-21" data-line-number="21">    <span class="cf">case</span> <span class="st">'INPUT_TASK'</span><span class="op">:</span></a>
<a class="sourceLine" id="cb71-22" data-line-number="22">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb71-23" data-line-number="23">        ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb71-24" data-line-number="24">        <span class="dt">task</span><span class="op">:</span> <span class="va">action</span>.<span class="va">payload</span>.<span class="at">task</span></a>
<a class="sourceLine" id="cb71-25" data-line-number="25">      <span class="op">};</span></a>
<a class="sourceLine" id="cb71-26" data-line-number="26">    <span class="cf">case</span> <span class="st">'ADD_TASK'</span><span class="op">:</span></a>
<a class="sourceLine" id="cb71-27" data-line-number="27">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb71-28" data-line-number="28">        ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb71-29" data-line-number="29">        <span class="dt">tasks</span><span class="op">:</span> <span class="va">state</span>.<span class="va">tasks</span>.<span class="at">concat</span>([<span class="va">action</span>.<span class="va">payload</span>.<span class="at">task</span>])</a>
<a class="sourceLine" id="cb71-30" data-line-number="30">      <span class="op">};</span></a>
<a class="sourceLine" id="cb71-31" data-line-number="31">    <span class="dt">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb71-32" data-line-number="32">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb71-33" data-line-number="33">  <span class="op">}</span></a>
<a class="sourceLine" id="cb71-34" data-line-number="34"><span class="op">}</span></a>
<a class="sourceLine" id="cb71-35" data-line-number="35"></a>
<a class="sourceLine" id="cb71-36" data-line-number="36"></a>
<a class="sourceLine" id="cb71-37" data-line-number="37"><span class="co">// Storeの生成</span></a>
<a class="sourceLine" id="cb71-38" data-line-number="38"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(tasksReducer)<span class="op">;</span></a>
<a class="sourceLine" id="cb71-39" data-line-number="39"></a>
<a class="sourceLine" id="cb71-40" data-line-number="40"><span class="co">// ActionCreatorの定義</span></a>
<a class="sourceLine" id="cb71-41" data-line-number="41"><span class="co">// 追加するtaskを引数に取り、Actionオブジェクトを返す</span></a>
<a class="sourceLine" id="cb71-42" data-line-number="42"><span class="kw">const</span> addTask <span class="op">=</span> (task) <span class="op">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb71-43" data-line-number="43">  <span class="dt">type</span><span class="op">:</span> <span class="st">'ADD_TASK'</span><span class="op">,</span></a>
<a class="sourceLine" id="cb71-44" data-line-number="44">  <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb71-45" data-line-number="45">    task</a>
<a class="sourceLine" id="cb71-46" data-line-number="46">  <span class="op">}</span></a>
<a class="sourceLine" id="cb71-47" data-line-number="47"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb71-48" data-line-number="48"></a>
<a class="sourceLine" id="cb71-49" data-line-number="49"></a>
<a class="sourceLine" id="cb71-50" data-line-number="50"><span class="co">// タスク入力用のActionCreator</span></a>
<a class="sourceLine" id="cb71-51" data-line-number="51"><span class="kw">const</span> inputTask <span class="op">=</span> (task) <span class="op">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb71-52" data-line-number="52">  <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;INPUT_TASK&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb71-53" data-line-number="53">  <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb71-54" data-line-number="54">    task</a>
<a class="sourceLine" id="cb71-55" data-line-number="55">  <span class="op">}</span></a>
<a class="sourceLine" id="cb71-56" data-line-number="56"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb71-57" data-line-number="57"></a>
<a class="sourceLine" id="cb71-58" data-line-number="58"></a>
<a class="sourceLine" id="cb71-59" data-line-number="59"><span class="kw">function</span> <span class="at">TodoApp</span>(<span class="op">{</span> store <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb71-60" data-line-number="60">  <span class="kw">const</span> <span class="op">{</span> task<span class="op">,</span> tasks <span class="op">}</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb71-61" data-line-number="61">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb71-62" data-line-number="62">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb71-63" data-line-number="63">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> onChange<span class="op">={</span>(e) <span class="op">=&gt;</span> <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">inputTask</span>(<span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span>))<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb71-64" data-line-number="64">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;button&quot;</span> value<span class="op">=</span><span class="st">&quot;add&quot;</span> onClick<span class="op">={</span>() <span class="op">=&gt;</span> <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addTask</span>(task))<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb71-65" data-line-number="65">      <span class="op">&lt;</span>ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb71-66" data-line-number="66">        <span class="op">{</span></a>
<a class="sourceLine" id="cb71-67" data-line-number="67">          <span class="va">tasks</span>.<span class="at">map</span>(<span class="kw">function</span>(item<span class="op">,</span> i) <span class="op">{</span></a>
<a class="sourceLine" id="cb71-68" data-line-number="68">            <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb71-69" data-line-number="69">              <span class="op">&lt;</span>li key<span class="op">={</span>i<span class="op">}&gt;{</span>item<span class="op">}</span>&lt;/li<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb71-70" data-line-number="70">            )<span class="op">;</span></a>
<a class="sourceLine" id="cb71-71" data-line-number="71">          <span class="op">}</span>)</a>
<a class="sourceLine" id="cb71-72" data-line-number="72">        <span class="op">}</span></a>
<a class="sourceLine" id="cb71-73" data-line-number="73">      &lt;/ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb71-74" data-line-number="74">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb71-75" data-line-number="75">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb71-76" data-line-number="76"><span class="op">}</span></a>
<a class="sourceLine" id="cb71-77" data-line-number="77"></a>
<a class="sourceLine" id="cb71-78" data-line-number="78"></a>
<a class="sourceLine" id="cb71-79" data-line-number="79"><span class="kw">function</span> <span class="at">renderApp</span>(store) <span class="op">{</span></a>
<a class="sourceLine" id="cb71-80" data-line-number="80">  <span class="at">render</span>(</a>
<a class="sourceLine" id="cb71-81" data-line-number="81">    <span class="op">&lt;</span>TodoApp store<span class="op">={</span>store<span class="op">}</span> /&gt;<span class="op">,</span></a>
<a class="sourceLine" id="cb71-82" data-line-number="82">    <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'root'</span>)</a>
<a class="sourceLine" id="cb71-83" data-line-number="83">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb71-84" data-line-number="84"><span class="op">}</span></a>
<a class="sourceLine" id="cb71-85" data-line-number="85"></a>
<a class="sourceLine" id="cb71-86" data-line-number="86"></a>
<a class="sourceLine" id="cb71-87" data-line-number="87"><span class="va">store</span>.<span class="at">subscribe</span>(() <span class="op">=&gt;</span> <span class="at">renderApp</span>(store))<span class="op">;</span></a>
<a class="sourceLine" id="cb71-88" data-line-number="88"><span class="at">renderApp</span>(store)<span class="op">;</span></a></code></pre></div>
<h3>ファイルを機能ごとに分割する</h3>
<p>ActionCreator、Store、Reducer、Componentの定義を、1ファイルにまとめて書きました。 これを役割ごとにファイルを分割したほうが視認性がよくなります。</p>
<p>次のフォルダ構造でファイルを分割します。</p>
<pre><code>src/
+---index.js
+---containers/
|     ... Container Component を置く
+---components/
|     ... Presentational Component を置く
+---actions/
|     ... ActionCreator を置く
`---reducers/
      ... Reducer を置く</code></pre>
<ol>
<li><p>Reducerの定義を<code>src/reducers/tasks.js</code>に移動します。</p>
<p>function には <code>export default</code> を付けてください。</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">const</span> initialState <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb73-2" data-line-number="2">  <span class="dt">task</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb73-3" data-line-number="3">  <span class="dt">tasks</span><span class="op">:</span> []</a>
<a class="sourceLine" id="cb73-4" data-line-number="4"><span class="op">};</span></a>
<a class="sourceLine" id="cb73-5" data-line-number="5"></a>
<a class="sourceLine" id="cb73-6" data-line-number="6"><span class="co">// Reducerの定義</span></a>
<a class="sourceLine" id="cb73-7" data-line-number="7"><span class="co">// 第1引数は、現在の状態を表すstateオブジェクト</span></a>
<a class="sourceLine" id="cb73-8" data-line-number="8"><span class="co">// 第2引数は、どのような操作をしたのかを示すActionオブジェクト</span></a>
<a class="sourceLine" id="cb73-9" data-line-number="9"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">tasksReducer</span>(state <span class="op">=</span> initialState<span class="op">,</span> action) <span class="op">{</span></a>
<a class="sourceLine" id="cb73-10" data-line-number="10">  <span class="cf">switch</span> (<span class="va">action</span>.<span class="at">type</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb73-11" data-line-number="11">    <span class="cf">case</span> <span class="st">'INPUT_TASK'</span><span class="op">:</span></a>
<a class="sourceLine" id="cb73-12" data-line-number="12">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb73-13" data-line-number="13">        ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb73-14" data-line-number="14">        <span class="dt">task</span><span class="op">:</span> <span class="va">action</span>.<span class="va">payload</span>.<span class="at">task</span></a>
<a class="sourceLine" id="cb73-15" data-line-number="15">      <span class="op">};</span></a>
<a class="sourceLine" id="cb73-16" data-line-number="16">    <span class="cf">case</span> <span class="st">'ADD_TASK'</span><span class="op">:</span></a>
<a class="sourceLine" id="cb73-17" data-line-number="17">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb73-18" data-line-number="18">        ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb73-19" data-line-number="19">        <span class="dt">tasks</span><span class="op">:</span> <span class="va">state</span>.<span class="va">tasks</span>.<span class="at">concat</span>([<span class="va">action</span>.<span class="va">payload</span>.<span class="at">task</span>])</a>
<a class="sourceLine" id="cb73-20" data-line-number="20">      <span class="op">};</span></a>
<a class="sourceLine" id="cb73-21" data-line-number="21">    <span class="dt">default</span><span class="op">:</span></a>
<a class="sourceLine" id="cb73-22" data-line-number="22">      <span class="cf">return</span> state<span class="op">;</span></a>
<a class="sourceLine" id="cb73-23" data-line-number="23">  <span class="op">}</span></a>
<a class="sourceLine" id="cb73-24" data-line-number="24"><span class="op">}</span></a></code></pre></div></li>
<li><p>ActionCreatorの定義を <code>src/actions/tasks.js</code> に移動します。</p>
<p>const に <code>export</code> を付けてください。</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="co">// ActionCreatorの定義</span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="co">// 追加するtaskを引数に取り、Actionオブジェクトを返す</span></a>
<a class="sourceLine" id="cb74-3" data-line-number="3"><span class="im">export</span> <span class="kw">const</span> addTask <span class="op">=</span> (task) <span class="op">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb74-4" data-line-number="4">  <span class="dt">type</span><span class="op">:</span> <span class="st">'ADD_TASK'</span><span class="op">,</span></a>
<a class="sourceLine" id="cb74-5" data-line-number="5">  <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb74-6" data-line-number="6">    task</a>
<a class="sourceLine" id="cb74-7" data-line-number="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb74-8" data-line-number="8"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb74-9" data-line-number="9"></a>
<a class="sourceLine" id="cb74-10" data-line-number="10"></a>
<a class="sourceLine" id="cb74-11" data-line-number="11"><span class="co">// タスク入力用のActionCreator</span></a>
<a class="sourceLine" id="cb74-12" data-line-number="12"><span class="im">export</span> <span class="kw">const</span> inputTask <span class="op">=</span> (task) <span class="op">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb74-13" data-line-number="13">  <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;INPUT_TASK&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb74-14" data-line-number="14">  <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb74-15" data-line-number="15">    task</a>
<a class="sourceLine" id="cb74-16" data-line-number="16">  <span class="op">}</span></a>
<a class="sourceLine" id="cb74-17" data-line-number="17"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div></li>
<li><p>Componentの定義を <code>src/components/TodoApp.js</code> に移動します。</p>
<p>componentsからActionをDispatchするため、先ほど移動したActionCreatorのファイルをインポートします。</p>
<p>（<code>import { inputTask, addTask } from '../actions/tasks';</code> の部分）</p>
<p>関数には <code>export default</code> を付けてください。</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="im">import</span> <span class="op">{</span> inputTask<span class="op">,</span> addTask <span class="op">}</span> <span class="im">from</span> <span class="st">'../actions/tasks'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb75-3" data-line-number="3"></a>
<a class="sourceLine" id="cb75-4" data-line-number="4"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">TodoApp</span>(<span class="op">{</span> store <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb75-5" data-line-number="5">  <span class="kw">const</span> <span class="op">{</span> task<span class="op">,</span> tasks <span class="op">}</span> <span class="op">=</span> <span class="va">store</span>.<span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb75-6" data-line-number="6">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb75-7" data-line-number="7">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb75-8" data-line-number="8">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> onChange<span class="op">={</span>(e) <span class="op">=&gt;</span> <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">inputTask</span>(<span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span>))<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb75-9" data-line-number="9">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;button&quot;</span> value<span class="op">=</span><span class="st">&quot;add&quot;</span> onClick<span class="op">={</span>() <span class="op">=&gt;</span> <span class="va">store</span>.<span class="at">dispatch</span>(<span class="at">addTask</span>(task))<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb75-10" data-line-number="10">      <span class="op">&lt;</span>ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb75-11" data-line-number="11">        <span class="op">{</span></a>
<a class="sourceLine" id="cb75-12" data-line-number="12">          <span class="va">tasks</span>.<span class="at">map</span>(<span class="kw">function</span>(item<span class="op">,</span> i) <span class="op">{</span></a>
<a class="sourceLine" id="cb75-13" data-line-number="13">            <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb75-14" data-line-number="14">              <span class="op">&lt;</span>li key<span class="op">={</span>i<span class="op">}&gt;{</span>item<span class="op">}</span>&lt;/li<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb75-15" data-line-number="15">            )<span class="op">;</span></a>
<a class="sourceLine" id="cb75-16" data-line-number="16">          <span class="op">}</span>)</a>
<a class="sourceLine" id="cb75-17" data-line-number="17">        <span class="op">}</span></a>
<a class="sourceLine" id="cb75-18" data-line-number="18">      &lt;/ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb75-19" data-line-number="19">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb75-20" data-line-number="20">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb75-21" data-line-number="21"><span class="op">}</span></a></code></pre></div></li>
<li><p><code>src\index.js</code> は、分割したファイルをインポートするように変更します。</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="im">import</span> <span class="op">{</span> render <span class="op">}</span> <span class="im">from</span> <span class="st">'react-dom'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb76-3" data-line-number="3"><span class="im">import</span> tasksReducer <span class="im">from</span> <span class="st">'./reducers/tasks'</span><span class="op">;</span>    <span class="co">// Reducerのインポート</span></a>
<a class="sourceLine" id="cb76-4" data-line-number="4"><span class="im">import</span> TodoApp <span class="im">from</span> <span class="st">'./components/TodoApp'</span><span class="op">;</span>     <span class="co">// Componentのインポート</span></a>
<a class="sourceLine" id="cb76-5" data-line-number="5"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">'redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb76-6" data-line-number="6"></a>
<a class="sourceLine" id="cb76-7" data-line-number="7"><span class="co">// Note: 使わないのでコメント化 &gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb76-8" data-line-number="8"><span class="co">// import './index.css';</span></a>
<a class="sourceLine" id="cb76-9" data-line-number="9"><span class="co">// import App from './App';</span></a>
<a class="sourceLine" id="cb76-10" data-line-number="10"><span class="co">// import registerServiceWorker from './registerServiceWorker';</span></a>
<a class="sourceLine" id="cb76-11" data-line-number="11"><span class="co">/// Note: &lt;&lt;&lt; 使わないのでコメント化</span></a>
<a class="sourceLine" id="cb76-12" data-line-number="12"></a>
<a class="sourceLine" id="cb76-13" data-line-number="13"><span class="co">// Storeの生成</span></a>
<a class="sourceLine" id="cb76-14" data-line-number="14"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(tasksReducer)<span class="op">;</span></a>
<a class="sourceLine" id="cb76-15" data-line-number="15"></a>
<a class="sourceLine" id="cb76-16" data-line-number="16"><span class="kw">function</span> <span class="at">renderApp</span>(store) <span class="op">{</span></a>
<a class="sourceLine" id="cb76-17" data-line-number="17">  <span class="at">render</span>(</a>
<a class="sourceLine" id="cb76-18" data-line-number="18">    <span class="op">&lt;</span>TodoApp store<span class="op">={</span>store<span class="op">}</span> /&gt;<span class="op">,</span></a>
<a class="sourceLine" id="cb76-19" data-line-number="19">    <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'root'</span>)</a>
<a class="sourceLine" id="cb76-20" data-line-number="20">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb76-21" data-line-number="21"><span class="op">}</span></a>
<a class="sourceLine" id="cb76-22" data-line-number="22"></a>
<a class="sourceLine" id="cb76-23" data-line-number="23"><span class="va">store</span>.<span class="at">subscribe</span>(() <span class="op">=&gt;</span> <span class="at">renderApp</span>(store))<span class="op">;</span></a>
<a class="sourceLine" id="cb76-24" data-line-number="24"><span class="at">renderApp</span>(store)<span class="op">;</span></a></code></pre></div></li>
</ol>
<!-- TODO: p.108 「最終的な」と書いておきつつ、サンプルコードに最後の2行がない。 -->
<h3>react-redux</h3>
<p><code>react-redux</code>は、ReactとReduxの連携をサポートするライブラリです。 Storeの状態変化に応じて該当部分のViewを再描画するのを手助けしてくれます。</p>
<h3>react-reduxのインストール</h3>
<pre><code>&gt; npm install --save react-redux</code></pre>
<!-- TODO: p109 `-save`になっている。半角ハイフンがひとつ足りない。 -->
<p>ReactはViewを扱うライブラリなので、Reduxが有するStoreやActionの情報と疎結合になっていることが望ましい。 そのほうがコンポーネント単体としてもテストしやすいし、コードの可読性も上がります。</p>
<dl>
<dt>Container Component</dt>
<dd><p>Reactコンポーネントをラップしたコンポーネント。</p>
<p>ReduxのStoreやActionを受け取り、ReactのPropsとして渡す役を担います。 Container Componentの責務は、ReactとReduxの橋渡しのみなので、JSXを記述するのは誤りです。</p>
</dd>
<dt>Presentational Component</dt>
<dd>Redux依存のない純粋なReactコンポーネント。
</dd>
</dl>
<h3>react-reduxの機能</h3>
<p>次の2つの機能があります。</p>
<ul>
<li><Provider></li>
<li>connect</li>
</ul>
<h4><Provider></h4>
<p>dispatchはStoreが持つメソッドなので、ReactコンポーネントからActionをdispatchさせるにはStoreが必要になります。 dispatchしたいコンポーネントすべてに対し、Storeを最上位から渡していくのは得策ではありません。</p>
<p><Provider>を使うことで<code>connect</code>という関数を使えるようになり、任意のコンポーネントに対してStoreとの紐付けができるようになります。</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="co">// 最上位のコンポーネントを&lt;Provider&gt;でラップして、propsにStoreを与える</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2"><span class="co">// （内部的にはReactのcontext経由でStoreを保持する仕組み）</span></a>
<a class="sourceLine" id="cb78-3" data-line-number="3"><span class="va">ReactDOM</span>.<span class="at">render</span>(</a>
<a class="sourceLine" id="cb78-4" data-line-number="4">  <span class="op">&lt;</span>Provider store<span class="op">={</span>store<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb78-5" data-line-number="5">    <span class="op">&lt;</span>MyRootComponent /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb78-6" data-line-number="6">  &lt;/Provider<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb78-7" data-line-number="7">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'root'</span>)</a>
<a class="sourceLine" id="cb78-8" data-line-number="8">)<span class="op">;</span></a></code></pre></div>
<h4>connect([mapStateToProps], [mapDispatchToProps], [mergeProps], [options])</h4>
<p>特定のComponentに対して、Reactのcontextで保持しているStoreを提供します。 Storeさえあれば<code>getState</code>で状態が取得できますし、Actionの<code>dispatch</code>もできます。</p>
<p>引数</p>
<dl>
<dt>mapStateToProps(state, [ownProps])</dt>
<dd><p>Storeから必要なstateを取り出し、ComponentのPropsに割り当てる関数を指定します。</p>
<p>第1引数はStoreのstate。 複数のReducerを組み合わせている場合は、必要な部分のstateのみ取り出して返すようにすれば、不要なコンポーネントを渡さずに済みます。</p>
<p>第2引数はオプションで、親コンポーネントから引き継がれてきたPropsが格納されています（下記の例では未使用）。</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw">function</span> <span class="at">mapStateToProps</span>(<span class="op">{</span> task<span class="op">,</span> tasks <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb79-3" data-line-number="3">    task<span class="op">,</span></a>
<a class="sourceLine" id="cb79-4" data-line-number="4">    tasks<span class="op">,</span></a>
<a class="sourceLine" id="cb79-5" data-line-number="5">  <span class="op">};</span></a>
<a class="sourceLine" id="cb79-6" data-line-number="6"><span class="op">}</span></a></code></pre></div>
<p>戻り値のオブジェクトは、connect先のComponentのPropsとして受け取ることができます。</p>
</dd>
<dt>mapDispatchToProps(dispatch, [ownProps])</dt>
<dd><p>Actionのdispatchを行う処理を指定します。そうすることでコンポーネントからdispatchの概念を隠蔽します。</p>
<p>第1引数に、Storeのdispatchメソッドが渡されてくるので、これを使ってActionをdispatchします。</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="co">// ActionCreator</span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="kw">const</span> addTask <span class="op">=</span> (task) <span class="op">=&gt;</span> (<span class="op">{</span></a>
<a class="sourceLine" id="cb80-3" data-line-number="3">  <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;ADD_TASK&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb80-4" data-line-number="4">  <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb80-5" data-line-number="5">    task</a>
<a class="sourceLine" id="cb80-6" data-line-number="6">  <span class="op">}</span></a>
<a class="sourceLine" id="cb80-7" data-line-number="7"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb80-8" data-line-number="8"></a>
<a class="sourceLine" id="cb80-9" data-line-number="9"><span class="kw">function</span> <span class="at">mapDispatchToProps</span>(dispatch) <span class="op">{</span></a>
<a class="sourceLine" id="cb80-10" data-line-number="10">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb80-11" data-line-number="11">    <span class="at">addTask</span>(task) <span class="op">{</span></a>
<a class="sourceLine" id="cb80-12" data-line-number="12">      <span class="at">dispatch</span>(<span class="at">addTask</span>(task))<span class="op">;</span></a>
<a class="sourceLine" id="cb80-13" data-line-number="13">    <span class="op">}</span></a>
<a class="sourceLine" id="cb80-14" data-line-number="14">  <span class="op">};</span></a>
<a class="sourceLine" id="cb80-15" data-line-number="15"><span class="op">}</span></a></code></pre></div>
<!-- TODO: p.112 dispatch(addTask(task});　← } ではなく ) では？ -->
</dd>
<dt>mergeProps(stateProps, dispatchProps, ownProps)</dt>
<dd><p><code>mapStateToProps</code>と<code>mapDispatchToProps</code>を経たそれぞれのPropsと、親から渡ってきた<code>ownProps</code>をマージして、コンポーネントに渡します。</p>
<p>既定では、以下のように、<code>Object.assign</code>関数を使って単純に3つをマージしたものを返す処理が設定されています。</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="kw">function</span> <span class="at">mergeProps</span>(stateProps<span class="op">,</span> dispatchProps<span class="op">,</span> ownProps) <span class="op">{</span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2">  <span class="cf">return</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> ownProps<span class="op">,</span> stateProps<span class="op">,</span> dispatchProps)<span class="op">;</span></a>
<a class="sourceLine" id="cb81-3" data-line-number="3"><span class="op">}</span></a></code></pre></div>
</dd>
<dt>options</dt>
<dd><p>オプションとして次の項目を設定できます。</p>
<dl>
<dt>pure - Boolean</dt>
<dd>規定値はtrueです。trueの場合、関連するState/Propsに変化がなければ、connectは再描画および<code>mapStateToProps</code>/<code>mapDispatchToProps</code>/<code>mergeProp</code>を呼び出しません。
</dd>
</dl>
</dd>
</dl>
<!-- TODO: p.114 mapStateToPrupsになっている。Propsでは？ -->
<pre><code>areStateEqual - Function
:   `pure`がtrueの場合、Storeの中身の差分判定をどのようにするか指定します。
    規定値は、strictEqual（===）です。

areOwnPropsEqual - Function
:   pureがtrueの場合、OwnPropの中身の差分判定をどのようにするか指定します。
    規定値は、shallowEqual（==）です。

areStatePropsEqual - Function
:   pureがtrueの場合、mapStateToPropsの結果の差分判定をどのようにするか指定します。
    規定値は、shallowEqual（==）です。

areMergedPropsEqual - Function
:   pureがtrueの場合、mergePropsの結果の差分判定をどのようにするか指定します。
    規定値は、shallowEqual（==）です。

storeKey - String
:   もし何らかの理由でStoreを複数用意したいときに指定します。

    通常であれば不要。</code></pre>
<h3>react-reduxの組み込み</h3>
<h4>Container Componentの作成</h4>
<p>ファイル<code>src\containers\TodoApp.js</code>を作ります。</p>
<p>これにより TodoApp コンポーネントには Prop として次の4つが渡されるようになります。</p>
<ul>
<li>task - フォームに入力されたタスク</li>
<li>tasks - タスクの配列</li>
<li>addTask - タスクを追加する関数</li>
<li>inputTask - タスクを入力する関数</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">'react-redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="im">import</span> TodoApp <span class="im">from</span> <span class="st">'../components/TodoApp'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb83-3" data-line-number="3"><span class="im">import</span> <span class="op">{</span> inputTask<span class="op">,</span> addTask <span class="op">}</span> <span class="im">from</span> <span class="st">'../actions/tasks'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb83-4" data-line-number="4"></a>
<a class="sourceLine" id="cb83-5" data-line-number="5"><span class="co">// Storeにある task と tasks という State を Props に渡す</span></a>
<a class="sourceLine" id="cb83-6" data-line-number="6"><span class="kw">function</span> <span class="at">mapStateToProps</span>(<span class="op">{</span> task<span class="op">,</span> tasks <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb83-7" data-line-number="7">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb83-8" data-line-number="8">    task<span class="op">,</span></a>
<a class="sourceLine" id="cb83-9" data-line-number="9">    tasks</a>
<a class="sourceLine" id="cb83-10" data-line-number="10">  <span class="op">};</span></a>
<a class="sourceLine" id="cb83-11" data-line-number="11"><span class="op">}</span></a>
<a class="sourceLine" id="cb83-12" data-line-number="12"></a>
<a class="sourceLine" id="cb83-13" data-line-number="13"><span class="co">// 該当のActionをDispatchさせる関数を Props に渡す</span></a>
<a class="sourceLine" id="cb83-14" data-line-number="14"><span class="kw">function</span> <span class="at">mapDispatchToProps</span>(dispatch) <span class="op">{</span></a>
<a class="sourceLine" id="cb83-15" data-line-number="15">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb83-16" data-line-number="16">    <span class="at">addTask</span>(task) <span class="op">{</span></a>
<a class="sourceLine" id="cb83-17" data-line-number="17">      <span class="at">dispatch</span>(<span class="at">addTask</span>(task))<span class="op">;</span></a>
<a class="sourceLine" id="cb83-18" data-line-number="18">    <span class="op">},</span></a>
<a class="sourceLine" id="cb83-19" data-line-number="19">    <span class="at">inputTask</span>(task) <span class="op">{</span></a>
<a class="sourceLine" id="cb83-20" data-line-number="20">      <span class="at">dispatch</span>(<span class="at">inputTask</span>(task))</a>
<a class="sourceLine" id="cb83-21" data-line-number="21">    <span class="op">}</span></a>
<a class="sourceLine" id="cb83-22" data-line-number="22">  <span class="op">};</span></a>
<a class="sourceLine" id="cb83-23" data-line-number="23"><span class="op">}</span></a>
<a class="sourceLine" id="cb83-24" data-line-number="24"></a>
<a class="sourceLine" id="cb83-25" data-line-number="25"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(mapStateToProps<span class="op">,</span> mapDispatchToProps)(TodoApp)<span class="op">;</span></a></code></pre></div>
<h4>TodoAppコンポーネントの修正</h4>
<p><code>src/components/TodoApp.js</code></p>
<dl>
<dt>変更前</dt>
<dd>StoreがPropsに渡ってきて、そこからStateを取得。
</dd>
<dt>変更後</dt>
<dd><p>containersから整形されたオブジェクトがPropsとして渡されてきます。 ActionCreatorやActionのDispatchもcontainers側でやるので、コンポーネント側はPropsで渡ってきたinputTaskとaddTaskを呼び出すだけになります。</p>
<p>これにより、コンポーネントのRedux依存が消え、再利用性も高まりました。</p>
</dd>
</dl>
<div class="sourceCode" id="cb84"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb84-2" data-line-number="2"></a>
<a class="sourceLine" id="cb84-3" data-line-number="3"><span class="co">// 引数を store から変更</span></a>
<a class="sourceLine" id="cb84-4" data-line-number="4"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">TodoApp</span>(<span class="op">{</span> task<span class="op">,</span> tasks<span class="op">,</span> inputTask<span class="op">,</span> addTask <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb84-5" data-line-number="5">  <span class="co">// onChange、onClickの指定時にdispatchが不要になる</span></a>
<a class="sourceLine" id="cb84-6" data-line-number="6">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb84-7" data-line-number="7">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb84-8" data-line-number="8">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> onChange<span class="op">={</span>(e) <span class="op">=&gt;</span> <span class="at">inputTask</span>(<span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span>)<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb84-9" data-line-number="9">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;button&quot;</span> value<span class="op">=</span><span class="st">&quot;add&quot;</span> onClick<span class="op">={</span>() <span class="op">=&gt;</span> <span class="at">addTask</span>(task)<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb84-10" data-line-number="10">      <span class="op">&lt;</span>ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb84-11" data-line-number="11">        <span class="op">{</span></a>
<a class="sourceLine" id="cb84-12" data-line-number="12">          <span class="va">tasks</span>.<span class="at">map</span>(<span class="kw">function</span>(item<span class="op">,</span> i) <span class="op">{</span></a>
<a class="sourceLine" id="cb84-13" data-line-number="13">            <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb84-14" data-line-number="14">              <span class="op">&lt;</span>li key<span class="op">={</span>i<span class="op">}&gt;{</span>item<span class="op">}</span>&lt;/li<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb84-15" data-line-number="15">            )<span class="op">;</span></a>
<a class="sourceLine" id="cb84-16" data-line-number="16">          <span class="op">}</span>)</a>
<a class="sourceLine" id="cb84-17" data-line-number="17">        <span class="op">}</span></a>
<a class="sourceLine" id="cb84-18" data-line-number="18">      &lt;/ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb84-19" data-line-number="19">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb84-20" data-line-number="20">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb84-21" data-line-number="21"><span class="op">}</span></a></code></pre></div>
<h4>index.jsの修正</h4>
<ul>
<li>Providerのimportを追加</li>
<li>TodoAppのimportをcomponentsではなくcontainersにする</li>
<li>Storeのsubscribeでコンポーネントの再描画を行っていた処理を削除する</li>
<li>function renderApp の処理を外に出す（render()をfunctionではなくする）</li>
</ul>
<div class="sourceCode" id="cb85"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2"><span class="im">import</span> <span class="op">{</span> Provider <span class="op">}</span> <span class="im">from</span> <span class="st">'react-redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb85-3" data-line-number="3"><span class="im">import</span> <span class="op">{</span> createStore <span class="op">}</span> <span class="im">from</span> <span class="st">'redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb85-4" data-line-number="4"><span class="im">import</span> <span class="op">{</span> render <span class="op">}</span> <span class="im">from</span> <span class="st">'react-dom'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb85-5" data-line-number="5"><span class="im">import</span> tasksReducer <span class="im">from</span> <span class="st">'./reducers/tasks'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb85-6" data-line-number="6"><span class="im">import</span> TodoApp <span class="im">from</span> <span class="st">'./containers/TodoApp'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb85-7" data-line-number="7"></a>
<a class="sourceLine" id="cb85-8" data-line-number="8"><span class="co">// Note: 使わないのでコメント化 &gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb85-9" data-line-number="9"><span class="co">// import './index.css';</span></a>
<a class="sourceLine" id="cb85-10" data-line-number="10"><span class="co">// import App from './App';</span></a>
<a class="sourceLine" id="cb85-11" data-line-number="11"><span class="co">// import registerServiceWorker from './registerServiceWorker';</span></a>
<a class="sourceLine" id="cb85-12" data-line-number="12"><span class="co">/// Note: &lt;&lt;&lt; 使わないのでコメント化</span></a>
<a class="sourceLine" id="cb85-13" data-line-number="13"></a>
<a class="sourceLine" id="cb85-14" data-line-number="14"><span class="co">// Storeの生成</span></a>
<a class="sourceLine" id="cb85-15" data-line-number="15"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(tasksReducer)<span class="op">;</span></a>
<a class="sourceLine" id="cb85-16" data-line-number="16"></a>
<a class="sourceLine" id="cb85-17" data-line-number="17"><span class="co">// &lt;Provider&gt;を追加</span></a>
<a class="sourceLine" id="cb85-18" data-line-number="18"><span class="at">render</span>(</a>
<a class="sourceLine" id="cb85-19" data-line-number="19">  <span class="op">&lt;</span>Provider store<span class="op">={</span>store<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb85-20" data-line-number="20">    <span class="op">&lt;</span>TodoApp /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb85-21" data-line-number="21">  &lt;/Provider<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb85-22" data-line-number="22">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'root'</span>)</a>
<a class="sourceLine" id="cb85-23" data-line-number="23">)<span class="op">;</span></a></code></pre></div>
<h4>connectAdvanced</h4>
<p>通常の<code>connect</code>よりも自由度を高くpropsの受け渡しをしたい場合、<code>connectAdvanced</code>を使うことができます。</p>
<p><code>mapStateToProps</code>や<code>mapDispatchToProps</code>、<code>mergeProps</code>のあたりの処理を自前で行うイメージです。</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="at">connectAdvanced</span>(selectorFactory<span class="op">,</span> [connectOptions])</a></code></pre></div>
<p>これらについては必要なときに調べるとしましょう。</p>
<h2>ルーティング</h2>
<p>ユーザーからの入力をもとに表示させるページを出し分けることをルーティングといいます。</p>
<p>実装の方法は、どのページにいるのかという情報（URL）をStoreで保持し、変化があった場合にViewを差し替えるようにします。</p>
<h3>実装パターン</h3>
<dl>
<dt>URL遷移なし</dt>
<dd><p>URLを使わずにアプリの内部で状態を保持する方法。</p>
<p>たとえば、Storeにpageというプロパティを用意し、ここでいまどのページにいるのかを管理します。 ですが、画面のリロードによって状態が元に戻ってしまうため現実的ではありません。</p>
</dd>
<dt>URL Hash</dt>
<dd><p>URL Hash（<code>#</code>)を使ってクライアントサイドのルーティングを実現する方法です。</p>
<p>aタグによるページ内移動と同じ仕組みなので、サーバーにリクエストは投げられません。</p>
<p>Hashは<code>location.hash</code>で取得できます。 hashが変更されたときに発火する<code>hashchange</code>イベントをハンドリングしてコンポーネントを描画します。</p>
</dd>
<dt>history API</dt>
<dd><p>ブラウザの履歴情報を操作するAPI（history API）を使った方法です。</p>
<ul>
<li><code>pushState</code>で履歴を追加できます。このとき、サーバーにリクエストは飛びません。</li>
<li>画面をリロードされたときは、その時点のURLにリクエストが投げられます。そのため、URLに該当するリソースがないと404エラーになってしまいます。</li>
<li>404エラーに対応するため、サーバーサイトで常にSPAの基点となるべきテンプレートを返すようにします。</li>
<li><code>webpack-dev-server</code>を使っているときは、History API Fallback機能を使うとWebサーバーが返すリソースがない場合、自動で index.html を返してくれます。</li>
<li>Reduxのconnectを使っている場合は<code>connect-history-api-fallback</code>というミドルウェアを使います。</li>
</ul>
</dd>
</dl>
<h3>ルーティングライブラリ</h3>
<dl>
<dt>React Router V4</dt>
<dd><p>メジャーなルーティングライブラリ。react-nativeを使ったアプリ開発でも使うことができます。</p>
<p>Webアプリでは<code>react-router-dom</code>パッケージを使います。</p>
</dd>
</dl>
<h4>インストール</h4>
<pre><code>&gt; npm install --save react-router-dom</code></pre>
<dl>
<dt>react-router-redux</dt>
<dd><p>react-routerをReduxに最適化したもの。</p>
<ul>
<li>react-routerのみでは、URLの変更を<Link>や<Redirect>経由でしかできません。</li>
<li>react-router-reduxでは、ルーティング情報をStoreのStateで管理しつつ、pushやreplaceといったAPIを使ってURLを変更できます。</li>
</ul>
</dd>
</dl>
<h4>インストール</h4>
<p>react-routerも動作に必要なので、react-router-domパッケージも一緒にインストールします。</p>
<dl>
<dt>Note:</dt>
<dd><p>react-router 4.x を使う場合、react-router-redux 5.x が必要です。 react-router-reduxに〝@next〟をつけてインストールします。</p>
<p><a href="https://github.com/ReactTraining/react-router/tree/master/packages/react-router-redux#installation">react-router-redux - Installation</a> より。</p>
</dd>
</dl>
<pre><code>&gt; npm install --save react-router-dom react-router-redux@next history</code></pre>
<h4>特徴</h4>
<ul>
<li>react-routerのAPIはそのまま利用できます。</li>
<li>react-router-reduxがやっていることは、historyオブジェクトを強化し、その変更をStoreのStateに常に同期することです。</li>
</ul>
<h4>導入方法</h4>
<p>Storeの生成処理が複雑なので別ファイルとして切り出します。 その中にStoreを生成する関数を定義します。</p>
<p><code>src/store/index.js</code>というファイルを作成します。</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="im">import</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb89-2" data-line-number="2">  <span class="co">// 名前が被るので別名でインポートする</span></a>
<a class="sourceLine" id="cb89-3" data-line-number="3">  createStore <span class="im">as</span> reduxCreateStore<span class="op">,</span></a>
<a class="sourceLine" id="cb89-4" data-line-number="4">  combineReducers<span class="op">,</span></a>
<a class="sourceLine" id="cb89-5" data-line-number="5">  applyMiddleware</a>
<a class="sourceLine" id="cb89-6" data-line-number="6"><span class="op">}</span> <span class="im">from</span> <span class="st">'redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb89-7" data-line-number="7"><span class="im">import</span> <span class="op">{</span> routerReducer<span class="op">,</span> routerMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">'react-router-redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb89-8" data-line-number="8"><span class="im">import</span> tasksReducer <span class="im">from</span> <span class="st">'../reducers/tasks'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb89-9" data-line-number="9"></a>
<a class="sourceLine" id="cb89-10" data-line-number="10"><span class="co">// Storeを生成するための関数を定義</span></a>
<a class="sourceLine" id="cb89-11" data-line-number="11"><span class="co">// historyはsrc/index.jsからもらう</span></a>
<a class="sourceLine" id="cb89-12" data-line-number="12"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">createStore</span>(history) <span class="op">{</span></a>
<a class="sourceLine" id="cb89-13" data-line-number="13">  <span class="cf">return</span> <span class="at">reduxCreateStore</span>(</a>
<a class="sourceLine" id="cb89-14" data-line-number="14">    <span class="at">combineReducers</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb89-15" data-line-number="15">      <span class="co">// tasksReducersをtasksというキーに割り当てる</span></a>
<a class="sourceLine" id="cb89-16" data-line-number="16">      <span class="dt">tasks</span><span class="op">:</span> tasksReducer<span class="op">,</span></a>
<a class="sourceLine" id="cb89-17" data-line-number="17">      <span class="co">// react-router-reduxのReducer</span></a>
<a class="sourceLine" id="cb89-18" data-line-number="18">      <span class="dt">router</span><span class="op">:</span> routerReducer</a>
<a class="sourceLine" id="cb89-19" data-line-number="19">    <span class="op">}</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb89-20" data-line-number="20">    <span class="at">applyMiddleware</span>(</a>
<a class="sourceLine" id="cb89-21" data-line-number="21">      <span class="co">// react-router-reduxのRedux Middleware</span></a>
<a class="sourceLine" id="cb89-22" data-line-number="22">      <span class="at">routerMiddleware</span>(history)</a>
<a class="sourceLine" id="cb89-23" data-line-number="23">    )</a>
<a class="sourceLine" id="cb89-24" data-line-number="24">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb89-25" data-line-number="25"><span class="op">}</span></a></code></pre></div>
<ul>
<li>react-router-reduxは<code>routerReducer</code>というルーティングのためのReducerを持っています。</li>
<li>自前のReducerと一緒に使うために、combineReducerを使ってReducerを合成します。</li>
<li>react-router-reduxはルーティングのための<code>routerMiddleware</code>というMiddlewareも提供しています。 このMiddlewareにより、ReduxのAction経由でルーティングを制御できるようになります。</li>
<li><code>applyMiddleware</code>を使って、<code>routerMiddleware</code>を適用します。</li>
</ul>
<p>Storeの生成</p>
<p><code>src/index.js</code>を変更します。</p>
<ul>
<li><code>import { createStore } from 'redux';</code>を消す。</li>
<li><code>import tasksReducer from './reducers/tasks';</code> を消す。</li>
<li><code>react-router-redux</code>と<code>history</code>、<code>src/store/index.js</code>のインポートを追加。</li>
<li>historyのインスタンス生成を追加。</li>
<li><ConnectedRouter>にhistoryを渡す処理を追加。</li>
<li>createStoreの引数を<code>tasksReducer</code>から<code>history</code>に変更。</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb90-2" data-line-number="2"><span class="im">import</span> <span class="op">{</span> Provider <span class="op">}</span> <span class="im">from</span> <span class="st">'react-redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb90-3" data-line-number="3"><span class="im">import</span> <span class="op">{</span> render <span class="op">}</span> <span class="im">from</span> <span class="st">'react-dom'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb90-4" data-line-number="4"><span class="im">import</span> <span class="op">{</span> ConnectedRouter <span class="op">}</span> <span class="im">from</span> <span class="st">'react-router-redux'</span><span class="op">;</span>             <span class="co">// 追加</span></a>
<a class="sourceLine" id="cb90-5" data-line-number="5"><span class="im">import</span> createBrowserHistory <span class="im">from</span> <span class="st">'history/createBrowserHistory'</span><span class="op">;</span>  <span class="co">// 追加</span></a>
<a class="sourceLine" id="cb90-6" data-line-number="6"><span class="im">import</span> TodoApp <span class="im">from</span> <span class="st">'./containers/TodoApp'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb90-7" data-line-number="7"><span class="im">import</span> createStore <span class="im">from</span> <span class="st">'./store'</span><span class="op">;</span>                                <span class="co">// 追加</span></a>
<a class="sourceLine" id="cb90-8" data-line-number="8"></a>
<a class="sourceLine" id="cb90-9" data-line-number="9"><span class="co">// Note: 使わないのでコメント化 &gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb90-10" data-line-number="10"><span class="co">// import './index.css';</span></a>
<a class="sourceLine" id="cb90-11" data-line-number="11"><span class="co">// import App from './App';</span></a>
<a class="sourceLine" id="cb90-12" data-line-number="12"><span class="co">// import registerServiceWorker from './registerServiceWorker';</span></a>
<a class="sourceLine" id="cb90-13" data-line-number="13"><span class="co">/// Note: &lt;&lt;&lt; 使わないのでコメント化</span></a>
<a class="sourceLine" id="cb90-14" data-line-number="14"></a>
<a class="sourceLine" id="cb90-15" data-line-number="15"><span class="co">// history のインスタンスを生成</span></a>
<a class="sourceLine" id="cb90-16" data-line-number="16"><span class="kw">const</span> history <span class="op">=</span> <span class="at">createBrowserHistory</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb90-17" data-line-number="17"></a>
<a class="sourceLine" id="cb90-18" data-line-number="18"><span class="co">// Storeの生成</span></a>
<a class="sourceLine" id="cb90-19" data-line-number="19"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(history)<span class="op">;</span></a>
<a class="sourceLine" id="cb90-20" data-line-number="20"></a>
<a class="sourceLine" id="cb90-21" data-line-number="21"><span class="co">// &lt;ConnectedRouter&gt;を追加</span></a>
<a class="sourceLine" id="cb90-22" data-line-number="22"><span class="at">render</span>(</a>
<a class="sourceLine" id="cb90-23" data-line-number="23">  <span class="op">&lt;</span>Provider store<span class="op">={</span>store<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb90-24" data-line-number="24">    <span class="op">&lt;</span>ConnectedRouter history<span class="op">={</span>history<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb90-25" data-line-number="25">      <span class="op">&lt;</span>TodoApp /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb90-26" data-line-number="26">    &lt;/ConnectedRouter<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb90-27" data-line-number="27">  &lt;/Provider<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb90-28" data-line-number="28">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'root'</span>)</a>
<a class="sourceLine" id="cb90-29" data-line-number="29">)<span class="op">;</span></a></code></pre></div>
<p><code>src/store/index.js</code>でReducerの合成をしたため、Reducerの構成が変更になっています。</p>
<p>Storeの構成</p>
<p>↓</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2">  <span class="dt">tasks</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb91-3" data-line-number="3">    <span class="dt">task</span><span class="op">:</span> <span class="st">&quot;&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb91-4" data-line-number="4">    <span class="dt">tasks</span><span class="op">:</span> []</a>
<a class="sourceLine" id="cb91-5" data-line-number="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb91-6" data-line-number="6">  <span class="dt">router</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb91-7" data-line-number="7">    <span class="dt">location</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb91-8" data-line-number="8">      <span class="co">// ルーティング情報</span></a>
<a class="sourceLine" id="cb91-9" data-line-number="9">    <span class="op">}</span></a>
<a class="sourceLine" id="cb91-10" data-line-number="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb91-11" data-line-number="11"><span class="op">}</span></a></code></pre></div>
<p>そのため、<code>src/containers/TodoApp.js</code>の<code>mapStateToProps</code>も変更する必要があります。</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw">function</span> <span class="at">mapStateToProps</span>(<span class="op">{</span> tasks <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb92-3" data-line-number="3">    <span class="dt">task</span><span class="op">:</span> <span class="va">tasks</span>.<span class="at">task</span><span class="op">,</span></a>
<a class="sourceLine" id="cb92-4" data-line-number="4">    <span class="dt">tasks</span><span class="op">:</span> <span class="va">tasks</span>.<span class="at">tasks</span></a>
<a class="sourceLine" id="cb92-5" data-line-number="5">  <span class="op">};</span></a>
<a class="sourceLine" id="cb92-6" data-line-number="6"><span class="op">}</span></a></code></pre></div>
<h4>Action経由によるルーティング</h4>
<p><code>routerMiddleware</code>を適用することで、Action経由でルーティングをすることができます。</p>
<p><code>react-router-redux</code>が用意している次のようなActionCreatorを用いたルーティングができるようになります。</p>
<dl>
<dt>push</dt>
<dd>履歴に新しいlocationを追加します。
</dd>
<dt>replace</dt>
<dd>現在の履歴を新しいlocationに置き換えます。
</dd>
<dt>go</dt>
<dd>相対値（1 や -2 など）を指定して、履歴を移動します。
</dd>
<dt>goForward</dt>
<dd>履歴を1つ進めます。
</dd>
<dt>goBack</dt>
<dd>履歴を1つ戻ります。
</dd>
</dl>
<h4>ボタンを押すとエラーページに移動するサンプル</h4>
<p><code>src/components/Error.js</code>ファイルを作成します。</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2"><span class="im">import</span> <span class="op">{</span> Link <span class="op">}</span> <span class="im">from</span> <span class="st">'react-router-dom'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb93-3" data-line-number="3"></a>
<a class="sourceLine" id="cb93-4" data-line-number="4"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">Error</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb93-5" data-line-number="5">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb93-6" data-line-number="6">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb93-7" data-line-number="7">      <span class="op">&lt;</span>h1<span class="op">&gt;</span>エラーページ&lt;/h1<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb93-8" data-line-number="8">      <span class="op">&lt;</span>Link to<span class="op">=</span><span class="st">&quot;/&quot;</span><span class="op">&gt;</span>戻る&lt;/Link<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb93-9" data-line-number="9">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb93-10" data-line-number="10">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb93-11" data-line-number="11"><span class="op">}</span></a></code></pre></div>
<p><code>src/index.js</code>を変更して、エラーページに移動できるようにします。</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-2" data-line-number="2"><span class="im">import</span> <span class="op">{</span> render <span class="op">}</span> <span class="im">from</span> <span class="st">'react-dom'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-3" data-line-number="3"><span class="im">import</span> <span class="op">{</span> Route <span class="op">}</span> <span class="im">from</span> <span class="st">'react-router-dom'</span><span class="op">;</span>     <span class="co">// 追加</span></a>
<a class="sourceLine" id="cb94-4" data-line-number="4"><span class="im">import</span> <span class="op">{</span> Provider <span class="op">}</span> <span class="im">from</span> <span class="st">'react-redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-5" data-line-number="5"><span class="im">import</span> <span class="op">{</span> ConnectedRouter <span class="op">}</span> <span class="im">from</span> <span class="st">'react-router-redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-6" data-line-number="6"><span class="im">import</span> createBrowserHistory <span class="im">from</span> <span class="st">'history/createBrowserHistory'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-7" data-line-number="7"><span class="im">import</span> TodoApp <span class="im">from</span> <span class="st">'./containers/TodoApp'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-8" data-line-number="8"><span class="im">import</span> Error <span class="im">from</span> <span class="st">'./components/Error'</span><span class="op">;</span>       <span class="co">// 追加</span></a>
<a class="sourceLine" id="cb94-9" data-line-number="9"><span class="im">import</span> createStore <span class="im">from</span> <span class="st">'./store'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb94-10" data-line-number="10"></a>
<a class="sourceLine" id="cb94-11" data-line-number="11"><span class="co">// Note: 使わないのでコメント化 &gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb94-12" data-line-number="12"><span class="co">// import './index.css';</span></a>
<a class="sourceLine" id="cb94-13" data-line-number="13"><span class="co">// import App from './App';</span></a>
<a class="sourceLine" id="cb94-14" data-line-number="14"><span class="co">// import registerServiceWorker from './registerServiceWorker';</span></a>
<a class="sourceLine" id="cb94-15" data-line-number="15"><span class="co">/// Note: &lt;&lt;&lt; 使わないのでコメント化</span></a>
<a class="sourceLine" id="cb94-16" data-line-number="16"></a>
<a class="sourceLine" id="cb94-17" data-line-number="17"><span class="co">// history のインスタンスを生成</span></a>
<a class="sourceLine" id="cb94-18" data-line-number="18"><span class="kw">const</span> history <span class="op">=</span> <span class="at">createBrowserHistory</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb94-19" data-line-number="19"></a>
<a class="sourceLine" id="cb94-20" data-line-number="20"><span class="co">// Storeの生成</span></a>
<a class="sourceLine" id="cb94-21" data-line-number="21"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(history)<span class="op">;</span></a>
<a class="sourceLine" id="cb94-22" data-line-number="22"></a>
<a class="sourceLine" id="cb94-23" data-line-number="23"><span class="co">// &lt;ConnectedRouter&gt;を追加</span></a>
<a class="sourceLine" id="cb94-24" data-line-number="24"><span class="at">render</span>(</a>
<a class="sourceLine" id="cb94-25" data-line-number="25">  <span class="op">&lt;</span>Provider store<span class="op">={</span>store<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb94-26" data-line-number="26">    <span class="op">&lt;</span>ConnectedRouter history<span class="op">={</span>history<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb94-27" data-line-number="27">      <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb94-28" data-line-number="28">        <span class="op">{</span> <span class="co">/* ルーティングさせる */</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb94-29" data-line-number="29">        <span class="op">&lt;</span>Route exact path<span class="op">=</span><span class="st">&quot;/&quot;</span> component<span class="op">={</span>TodoApp<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb94-30" data-line-number="30">        <span class="op">&lt;</span>Route exact path<span class="op">=</span><span class="st">&quot;/error&quot;</span> component<span class="op">={</span>Error<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb94-31" data-line-number="31">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb94-32" data-line-number="32">    &lt;/ConnectedRouter<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb94-33" data-line-number="33">  &lt;/Provider<span class="op">&gt;,</span></a>
<a class="sourceLine" id="cb94-34" data-line-number="34">  <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">'root'</span>)</a>
<a class="sourceLine" id="cb94-35" data-line-number="35">)<span class="op">;</span></a></code></pre></div>
<p><code>react-router-dom</code>のRouteコンポーネントを使ってルーティングを用意しています。</p>
<p><code>/</code> であれば、Todoアプリを表示。 <code>/error</code>であれば、エラーページを表示。</p>
<p><code>src/containers/TodoApp.js</code>にエラーページにリダイレクトさせる処理を追加します。</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="im">import</span> <span class="op">{</span> connect <span class="op">}</span> <span class="im">from</span> <span class="st">'react-redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb95-2" data-line-number="2"><span class="im">import</span> <span class="op">{</span> push <span class="op">}</span> <span class="im">from</span> <span class="st">'react-router-redux'</span><span class="op">;</span>    <span class="co">// 追加</span></a>
<a class="sourceLine" id="cb95-3" data-line-number="3"><span class="im">import</span> TodoApp <span class="im">from</span> <span class="st">'../components/TodoApp'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb95-4" data-line-number="4"><span class="im">import</span> <span class="op">{</span> inputTask<span class="op">,</span> addTask <span class="op">}</span> <span class="im">from</span> <span class="st">'../actions/tasks'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb95-5" data-line-number="5"></a>
<a class="sourceLine" id="cb95-6" data-line-number="6"><span class="co">// Storeにある task と tasks という State を Props に渡す</span></a>
<a class="sourceLine" id="cb95-7" data-line-number="7"><span class="kw">function</span> <span class="at">mapStateToProps</span>(<span class="op">{</span> tasks <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb95-8" data-line-number="8">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb95-9" data-line-number="9">    <span class="dt">task</span><span class="op">:</span> <span class="va">tasks</span>.<span class="at">task</span><span class="op">,</span></a>
<a class="sourceLine" id="cb95-10" data-line-number="10">    <span class="dt">tasks</span><span class="op">:</span> <span class="va">tasks</span>.<span class="at">tasks</span></a>
<a class="sourceLine" id="cb95-11" data-line-number="11">  <span class="op">};</span></a>
<a class="sourceLine" id="cb95-12" data-line-number="12"><span class="op">}</span></a>
<a class="sourceLine" id="cb95-13" data-line-number="13"></a>
<a class="sourceLine" id="cb95-14" data-line-number="14"><span class="co">// 該当のActionをDispatchさせる関数を Props に渡す</span></a>
<a class="sourceLine" id="cb95-15" data-line-number="15"><span class="kw">function</span> <span class="at">mapDispatchToProps</span>(dispatch) <span class="op">{</span></a>
<a class="sourceLine" id="cb95-16" data-line-number="16">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb95-17" data-line-number="17">    <span class="at">addTask</span>(task) <span class="op">{</span></a>
<a class="sourceLine" id="cb95-18" data-line-number="18">      <span class="at">dispatch</span>(<span class="at">addTask</span>(task))<span class="op">;</span></a>
<a class="sourceLine" id="cb95-19" data-line-number="19">    <span class="op">},</span></a>
<a class="sourceLine" id="cb95-20" data-line-number="20">    <span class="at">inputTask</span>(task) <span class="op">{</span></a>
<a class="sourceLine" id="cb95-21" data-line-number="21">      <span class="at">dispatch</span>(<span class="at">inputTask</span>(task))</a>
<a class="sourceLine" id="cb95-22" data-line-number="22">    <span class="op">},</span></a>
<a class="sourceLine" id="cb95-23" data-line-number="23">    <span class="co">// リダイレクト処理を追加</span></a>
<a class="sourceLine" id="cb95-24" data-line-number="24">    <span class="co">// react-router-reduxが提供しているpushというActionCreatorを使う</span></a>
<a class="sourceLine" id="cb95-25" data-line-number="25">    <span class="at">redirectToError</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb95-26" data-line-number="26">      <span class="at">dispatch</span>(<span class="at">push</span>(<span class="st">'/error'</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb95-27" data-line-number="27">    <span class="op">},</span></a>
<a class="sourceLine" id="cb95-28" data-line-number="28">  <span class="op">};</span></a>
<a class="sourceLine" id="cb95-29" data-line-number="29"><span class="op">}</span></a>
<a class="sourceLine" id="cb95-30" data-line-number="30"></a>
<a class="sourceLine" id="cb95-31" data-line-number="31"><span class="im">export</span> <span class="im">default</span> <span class="at">connect</span>(mapStateToProps<span class="op">,</span> mapDispatchToProps)(TodoApp)<span class="op">;</span></a></code></pre></div>
<p>リダイレクトする処理を呼び出せるように、<code>src/components/TodoApp.js</code>を変更します。</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">'react'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2"></a>
<a class="sourceLine" id="cb96-3" data-line-number="3"><span class="co">// 引数に redirectToError を追加</span></a>
<a class="sourceLine" id="cb96-4" data-line-number="4"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">TodoApp</span>(<span class="op">{</span> task<span class="op">,</span> tasks<span class="op">,</span> inputTask<span class="op">,</span> addTask<span class="op">,</span> redirectToError <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb96-5" data-line-number="5">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb96-6" data-line-number="6">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb96-7" data-line-number="7">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> onChange<span class="op">={</span>(e) <span class="op">=&gt;</span> <span class="at">inputTask</span>(<span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span>)<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb96-8" data-line-number="8">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;button&quot;</span> value<span class="op">=</span><span class="st">&quot;add&quot;</span> onClick<span class="op">={</span>() <span class="op">=&gt;</span> <span class="at">addTask</span>(task)<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb96-9" data-line-number="9">      <span class="op">&lt;</span>ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb96-10" data-line-number="10">        <span class="op">{</span></a>
<a class="sourceLine" id="cb96-11" data-line-number="11">          <span class="va">tasks</span>.<span class="at">map</span>(<span class="kw">function</span>(item<span class="op">,</span> i) <span class="op">{</span></a>
<a class="sourceLine" id="cb96-12" data-line-number="12">            <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb96-13" data-line-number="13">              <span class="op">&lt;</span>li key<span class="op">={</span>i<span class="op">}&gt;{</span>item<span class="op">}</span>&lt;/li<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb96-14" data-line-number="14">            )<span class="op">;</span></a>
<a class="sourceLine" id="cb96-15" data-line-number="15">          <span class="op">}</span>)</a>
<a class="sourceLine" id="cb96-16" data-line-number="16">        <span class="op">}</span></a>
<a class="sourceLine" id="cb96-17" data-line-number="17">      &lt;/ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb96-18" data-line-number="18">      <span class="op">{</span> <span class="co">/* 追加 */</span> <span class="op">}</span></a>
<a class="sourceLine" id="cb96-19" data-line-number="19">      <span class="op">&lt;</span>button onClick<span class="op">={</span>() <span class="op">=&gt;</span> <span class="at">redirectToError</span>()<span class="op">}&gt;</span>エラーページへ移動&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb96-20" data-line-number="20">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb96-21" data-line-number="21">  )<span class="op">;</span></a>
<a class="sourceLine" id="cb96-22" data-line-number="22"><span class="op">}</span></a></code></pre></div>
<h2>Redux Middleware</h2>
<p>Redux Middleware とは、Reduxの機能を拡張する仕組みです。</p>
<p>Middleware ＝ 拡張機能</p>
<p>Redux自体は軽量なアーキテクチャなので、単体では提供していない機能もある。</p>
<ul>
<li>Actionのログを取るミドルウェア</li>
<li>非同期処理を可能にするミドルウェア</li>
<li>クラッシュレポートを送信するためのミドルウェア</li>
<li>ルーティングのためのミドルウェア</li>
<li>etc...</li>
</ul>
<h3>Actionのログを取るミドルウェア</h3>
<p><code>redux-logger</code>はActionがDispatchされる前後のstateと、DispatchされたActionをコンソールに表示します。 開発時に有用なミドルウェアなのでインストールしたほうがよいでしょう。</p>
<h4>インストール</h4>
<pre><code>&gt; npm install --save redux-logger</code></pre>
<!-- TODO: p.143 install が insta'l になっている -->
<h4>ミドルウェアの適用</h4>
<p>Reduxにミドルウェアを適用するには、<code>applyMiddleware</code>関数を利用します。</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="co">// ミドルウェアの適用に必要な applyMiddleware 関数をインポートします</span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">'redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb98-3" data-line-number="3"></a>
<a class="sourceLine" id="cb98-4" data-line-number="4"><span class="co">// ミドルウェアをインポートします</span></a>
<a class="sourceLine" id="cb98-5" data-line-number="5"><span class="im">import</span> logger <span class="im">from</span> <span class="st">'redux-logger'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb98-6" data-line-number="6"></a>
<a class="sourceLine" id="cb98-7" data-line-number="7"><span class="co">// createStoreの第2引数に applyMiddleware を指定し、その引数にミドルウェアを指定します</span></a>
<a class="sourceLine" id="cb98-8" data-line-number="8"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb98-9" data-line-number="9">  reducer<span class="op">,</span></a>
<a class="sourceLine" id="cb98-10" data-line-number="10">  <span class="at">applyMiddleware</span>(logger)</a>
<a class="sourceLine" id="cb98-11" data-line-number="11">)<span class="op">;</span></a></code></pre></div>
<p><code>applyMiddleware</code>の引数は可変数なので、複数のミドルウェアを指定するときは、以下のようにカンマ区切りで並べて指定します。</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="at">applyMiddleware</span>(middleware1<span class="op">,</span> middleware2<span class="op">,</span> middleware3)</a></code></pre></div>
<h2>非同期処理</h2>
<h3>同期処理と非同期処理</h3>
<dl>
<dt>同期処理</dt>
<dd><p>書いた順に実行される処理</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;start&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb100-2" data-line-number="2"><span class="va">console</span>.<span class="at">log</span>(<span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb100-3" data-line-number="3"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;end&quot;</span>)<span class="op">;</span></a></code></pre></div>
</dd>
<dt>非同期処理</dt>
<dd><p>必ずしも書いた順には実行されない処理</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;start&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2"><span class="at">setTimeout</span>(<span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb101-3" data-line-number="3">  <span class="va">console</span>.<span class="at">log</span>(<span class="dv">1</span> <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-4" data-line-number="4"><span class="op">},</span> <span class="dv">1000</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb101-5" data-line-number="5"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&quot;end&quot;</span>)<span class="op">;</span></a></code></pre></div>
<p>非同期処理のあとに任意の処理を実行する方法として、コールバック関数やPromise、Async/Awaitなどがあります。</p>
</dd>
</dl>
<h3>redux-thunkによる非同期処理</h3>
<p>ReduxではAPIから何かレスポンスが返ってきたら、これをActionとして扱うという作法があります。 これを通常のActionCreatorで記述しようとすると、実はうまく書けません。</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw">const</span> requestAPI <span class="op">=</span> (parameter) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb102-2" data-line-number="2">  <span class="kw">const</span> response <span class="op">=</span> </a>
<a class="sourceLine" id="cb102-3" data-line-number="3">    <span class="at">fetch</span>(<span class="st">'APIのURL'</span><span class="op">,</span> parameter).<span class="at">then</span>((response) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb102-4" data-line-number="4">      <span class="co">// ここで返してもうまく動かない</span></a>
<a class="sourceLine" id="cb102-5" data-line-number="5">      <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb102-6" data-line-number="6">        <span class="dt">type</span><span class="op">:</span> <span class="st">&quot;REQUEST_API&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb102-7" data-line-number="7">        <span class="dt">data</span><span class="op">:</span> response</a>
<a class="sourceLine" id="cb102-8" data-line-number="8">      <span class="op">};</span></a>
<a class="sourceLine" id="cb102-9" data-line-number="9">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb102-10" data-line-number="10"><span class="op">};</span></a></code></pre></div>
<p>Action自体は単なるオブジェクトです。これをstore.dispatch()に与えることでActionが実行されます。 どうにかしてdispatch関数をコード中で使いたい。というときにこのミドルウェアの出番です。</p>
<h3>thunk ミドルウェア</h3>
<p>Reduxで非同期処理をする代表的なミドルウェア。</p>
<pre><code>&gt; npm install --save redux-thunk</code></pre>
<p>インストールできたらミドルウェアを適用します。</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="im">import</span> <span class="op">{</span> createStore<span class="op">,</span> applyMiddleware <span class="op">}</span> <span class="im">from</span> <span class="st">'redux'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb104-2" data-line-number="2"><span class="im">import</span> logger <span class="im">from</span> <span class="st">'redux-logger'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb104-3" data-line-number="3"><span class="im">import</span> thunk <span class="im">from</span> <span class="st">'redux-thunk'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb104-4" data-line-number="4"><span class="im">import</span> reducers <span class="im">from</span> <span class="st">'./reducers'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb104-5" data-line-number="5"></a>
<a class="sourceLine" id="cb104-6" data-line-number="6"><span class="kw">const</span> middlewares <span class="op">=</span> [logger<span class="op">,</span> thunk]<span class="op">;</span></a>
<a class="sourceLine" id="cb104-7" data-line-number="7"></a>
<a class="sourceLine" id="cb104-8" data-line-number="8"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(</a>
<a class="sourceLine" id="cb104-9" data-line-number="9">  reducers<span class="op">,</span></a>
<a class="sourceLine" id="cb104-10" data-line-number="10">  <span class="at">applyMiddleware</span>(...<span class="at">middlewares</span>)</a>
<a class="sourceLine" id="cb104-11" data-line-number="11">)<span class="op">;</span></a>
<a class="sourceLine" id="cb104-12" data-line-number="12"></a>
<a class="sourceLine" id="cb104-13" data-line-number="13"><span class="im">export</span> <span class="im">default</span> store<span class="op">;</span></a></code></pre></div>
<h3>非同期アクション</h3>
<p>thunkミドルウェアの適用により、非同期で実行されるActionを書けるようになりました。</p>
<p>次のコードサンプルで使っているshortidパッケージはユニークなIDを自動で生成してくれるものです。 インストールは <code>npm install --save shortid</code> でできます。</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="im">import</span> shortid <span class="im">from</span> <span class="st">'shortid'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb105-2" data-line-number="2"></a>
<a class="sourceLine" id="cb105-3" data-line-number="3"><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> types <span class="im">from</span> <span class="st">'../types/todo'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb105-4" data-line-number="4"></a>
<a class="sourceLine" id="cb105-5" data-line-number="5"><span class="co">// 同期 ActionCreator</span></a>
<a class="sourceLine" id="cb105-6" data-line-number="6"><span class="im">export</span> <span class="kw">function</span> <span class="at">addTodo</span>(title) <span class="op">{</span></a>
<a class="sourceLine" id="cb105-7" data-line-number="7">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb105-8" data-line-number="8">    <span class="dt">type</span><span class="op">:</span> <span class="va">types</span>.<span class="at">ADD_TODO</span><span class="op">,</span></a>
<a class="sourceLine" id="cb105-9" data-line-number="9">    <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb105-10" data-line-number="10">      <span class="dt">id</span><span class="op">:</span> <span class="va">shortid</span>.<span class="at">generate</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb105-11" data-line-number="11">      title</a>
<a class="sourceLine" id="cb105-12" data-line-number="12">    <span class="op">},</span></a>
<a class="sourceLine" id="cb105-13" data-line-number="13">  <span class="op">};</span></a>
<a class="sourceLine" id="cb105-14" data-line-number="14"><span class="op">}</span></a>
<a class="sourceLine" id="cb105-15" data-line-number="15"></a>
<a class="sourceLine" id="cb105-16" data-line-number="16"><span class="co">// 非同期 ActionCreator</span></a>
<a class="sourceLine" id="cb105-17" data-line-number="17"><span class="im">export</span> <span class="kw">function</span> <span class="at">asyncAddTodo</span>(title) <span class="op">{</span></a>
<a class="sourceLine" id="cb105-18" data-line-number="18">  <span class="cf">return</span> (dispatch<span class="op">,</span> getState) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb105-19" data-line-number="19">    <span class="at">setTimeout</span>(() <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb105-20" data-line-number="20">      <span class="at">dispatch</span>(<span class="at">addTodo</span>(title))<span class="op">;</span></a>
<a class="sourceLine" id="cb105-21" data-line-number="21">    <span class="op">},</span> <span class="dv">1000</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb105-22" data-line-number="22">  <span class="op">};</span></a>
<a class="sourceLine" id="cb105-23" data-line-number="23"><span class="op">}</span></a></code></pre></div>
<p>同期 ActionCreator はActionオブジェクトを返しています。</p>
<p>非同期 ActionCreator は関数を返しています。 thunkミドルウェアにより、通常のActionオブジェクト以外に関数を返せるようになります。 ここで返した関数は、引数としてdispatch関数とgetState関数を取ります。</p>
<p>dispatch関数はActionオブジェクトを受け取りさえすれば、同期的にreducerに処理を移します。</p>
<p>dispatch関数にさらに関数を渡すこともできます。このときも関数の引数としてdispatch関数とgetState関数を取ります。</p>
<dl>
<dt>ポイント</dt>
<dd>Reduxアプリでは、最終的にdispatch関数にActionオブジェクトを渡せばreducerに処理が移るという原則がある。
</dd>
</dl>
<h3>thunk と Promise、Async/Await</h3>
<dl>
<dt>Promise</dt>
<dd><div class="sourceCode" id="cb106"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">const</span> sleep1000ms <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb106-2" data-line-number="2">  <span class="cf">return</span> <span class="kw">new</span> <span class="at">Promise</span>(resolve <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb106-3" data-line-number="3">    <span class="at">setTimeout</span>(() <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb106-4" data-line-number="4">      <span class="at">resolve</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb106-5" data-line-number="5">    <span class="op">},</span> <span class="dv">1000</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb106-6" data-line-number="6">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb106-7" data-line-number="7"><span class="op">};</span></a>
<a class="sourceLine" id="cb106-8" data-line-number="8"></a>
<a class="sourceLine" id="cb106-9" data-line-number="9"><span class="im">export</span> <span class="kw">function</span> <span class="at">addTodo</span>(title) <span class="op">{</span></a>
<a class="sourceLine" id="cb106-10" data-line-number="10">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb106-11" data-line-number="11">    <span class="dt">type</span><span class="op">:</span> <span class="va">types</span>.<span class="at">ADD_TODO</span><span class="op">,</span></a>
<a class="sourceLine" id="cb106-12" data-line-number="12">    <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb106-13" data-line-number="13">      <span class="dt">id</span><span class="op">:</span> <span class="va">shortid</span>.<span class="at">generate</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb106-14" data-line-number="14">      title<span class="op">,</span></a>
<a class="sourceLine" id="cb106-15" data-line-number="15">    <span class="op">},</span></a>
<a class="sourceLine" id="cb106-16" data-line-number="16">  <span class="op">};</span></a>
<a class="sourceLine" id="cb106-17" data-line-number="17"><span class="op">}</span></a>
<a class="sourceLine" id="cb106-18" data-line-number="18"></a>
<a class="sourceLine" id="cb106-19" data-line-number="19"><span class="co">// Promise 版</span></a>
<a class="sourceLine" id="cb106-20" data-line-number="20"><span class="im">export</span> <span class="kw">function</span> <span class="at">asyncAddTodo</span>(title) <span class="op">{</span></a>
<a class="sourceLine" id="cb106-21" data-line-number="21">  <span class="cf">return</span> (dispatch) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb106-22" data-line-number="22">    <span class="at">sleep1000ms</span>().<span class="at">then</span>(() <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb106-23" data-line-number="23">      <span class="at">dispatch</span>(<span class="at">addTodo</span>(title))<span class="op">;</span></a>
<a class="sourceLine" id="cb106-24" data-line-number="24">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb106-25" data-line-number="25">  <span class="op">};</span></a>
<a class="sourceLine" id="cb106-26" data-line-number="26"><span class="op">}</span></a></code></pre></div>
</dd>
<dt>Async/Await</dt>
<dd><div class="sourceCode" id="cb107"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="kw">const</span> sleep1000ms <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb107-2" data-line-number="2">  ... 上記サンプルと同じ</a>
<a class="sourceLine" id="cb107-3" data-line-number="3"><span class="op">};</span></a>
<a class="sourceLine" id="cb107-4" data-line-number="4"></a>
<a class="sourceLine" id="cb107-5" data-line-number="5"><span class="im">export</span> <span class="kw">function</span> <span class="at">addTodo</span>(title) <span class="op">{</span></a>
<a class="sourceLine" id="cb107-6" data-line-number="6">  ... 上記サンプルと同じ</a>
<a class="sourceLine" id="cb107-7" data-line-number="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb107-8" data-line-number="8"></a>
<a class="sourceLine" id="cb107-9" data-line-number="9"><span class="co">// Async/Await 版</span></a>
<a class="sourceLine" id="cb107-10" data-line-number="10"><span class="im">export</span> <span class="kw">function</span> <span class="at">asyncAddTodo</span>(title) <span class="op">{</span></a>
<a class="sourceLine" id="cb107-11" data-line-number="11">  <span class="cf">return</span> <span class="at">async</span>(dispatch) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb107-12" data-line-number="12">    await <span class="at">sleep1000ms</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb107-13" data-line-number="13">    <span class="at">dispatch</span>(<span class="at">addTodo</span>(title))<span class="op">;</span></a>
<a class="sourceLine" id="cb107-14" data-line-number="14">  <span class="op">};</span></a>
<a class="sourceLine" id="cb107-15" data-line-number="15"><span class="op">}</span></a></code></pre></div>
</dd>
</dl>
<h3>複数のアクションをまとめる</h3>
<p>通常のActionCreatorでは、1つの関数では1つのActionしか返せませんでした。 thunkはこれらを1つにまとめたActionとして返すことができます。</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="kw">function</span> <span class="at">addTodo</span>(title) <span class="op">{</span></a>
<a class="sourceLine" id="cb108-2" data-line-number="2">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb108-3" data-line-number="3">    <span class="dt">type</span><span class="op">:</span> <span class="va">types</span>.<span class="at">ADD_TODO</span><span class="op">,</span></a>
<a class="sourceLine" id="cb108-4" data-line-number="4">    <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb108-5" data-line-number="5">      <span class="dt">id</span><span class="op">:</span> <span class="va">shortid</span>.<span class="at">generate</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb108-6" data-line-number="6">      title<span class="op">,</span></a>
<a class="sourceLine" id="cb108-7" data-line-number="7">    <span class="op">},</span></a>
<a class="sourceLine" id="cb108-8" data-line-number="8">  <span class="op">};</span></a>
<a class="sourceLine" id="cb108-9" data-line-number="9"><span class="op">}</span></a>
<a class="sourceLine" id="cb108-10" data-line-number="10"></a>
<a class="sourceLine" id="cb108-11" data-line-number="11"><span class="kw">function</span> <span class="at">updateInput</span>(value) <span class="op">{</span></a>
<a class="sourceLine" id="cb108-12" data-line-number="12">  <span class="cf">return</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb108-13" data-line-number="13">    <span class="dt">type</span><span class="op">:</span> <span class="va">types</span>.<span class="at">UPDATE_INPUT</span><span class="op">,</span></a>
<a class="sourceLine" id="cb108-14" data-line-number="14">    <span class="dt">payload</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb108-15" data-line-number="15">      value<span class="op">,</span></a>
<a class="sourceLine" id="cb108-16" data-line-number="16">    <span class="op">},</span></a>
<a class="sourceLine" id="cb108-17" data-line-number="17">  <span class="op">};</span></a>
<a class="sourceLine" id="cb108-18" data-line-number="18"><span class="op">}</span></a>
<a class="sourceLine" id="cb108-19" data-line-number="19"></a>
<a class="sourceLine" id="cb108-20" data-line-number="20"><span class="co">// 上の2つのActionを1つにまとめる</span></a>
<a class="sourceLine" id="cb108-21" data-line-number="21"><span class="co">// これをReactコンポーネントにバインドする</span></a>
<a class="sourceLine" id="cb108-22" data-line-number="22"><span class="im">export</span> <span class="kw">function</span> <span class="at">addTodoAndClear</span>(title) <span class="op">{</span></a>
<a class="sourceLine" id="cb108-23" data-line-number="23">  <span class="cf">return</span> (dispatch) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb108-24" data-line-number="24">    <span class="at">dispatch</span>(<span class="at">addTodo</span>(title))<span class="op">;</span></a>
<a class="sourceLine" id="cb108-25" data-line-number="25">    <span class="at">dispatch</span>(<span class="at">updateInput</span>(<span class="st">''</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb108-26" data-line-number="26">  <span class="op">};</span></a>
<a class="sourceLine" id="cb108-27" data-line-number="27"><span class="op">}</span></a></code></pre></div>
<p>1つの操作で複数の処理を行うときのアプローチとして、以下が考えられます。</p>
<ul>
<li>ActionCreatorでまとめる。</li>
<li>1つのActionとして記述し、reducerで2つの操作を行う。</li>
<li>複数のActionをReactコンポーネントのボタンにバインドする。</li>
</ul>
<p>ActionCreatorでまとめるのがベターな方法です。 理由は次の2つです。</p>
<ol>
<li><p>それぞれのActionの処理を独立して考えられる。</p>
<p>サンプルコードの場合、TODOを追加することと、フォームをクリアすることに直接の関係はありません。 TODOをコピーするときなどフォームを使わずにTODOを追加する方法を増やすときは、addTodo関数については再利用ができそうです。</p></li>
<li><p>ActionCreatorをユーザー操作とひも付けられる。</p>
<p>ActionCreatorはContainerコンポーネントからpropsとしてUI要素を持つプレゼンテーショナルコンポーネントに渡されるはずです。 このとき、プレゼンテーショナルコンポーネントは「このボタンを押すと何が起きるかはわからないが、渡された関数を叩けばよい」というように作られているべきです。</p>
<p>ボタンを押したら「TODOを追加する関数を叩く」のと「フォームをクリアする関数を叩く」ことをプレゼンテーショナルコンポーネントに書いてしまうと、コンポーネントはビジネスロジックや仕様を反映し、汎用性を失ってしまいます。</p></li>
</ol>
<h3>getState関数</h3>
<p>getState関数はstoreが持つ関数と同一で、すべてのstateを返します。 ActionCreator内でstoreの内容を知ることで、できることが広がります。</p>
<p>たとえば、登録済みのTODOは追加しないようにする。など。</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="im">export</span> <span class="kw">function</span> <span class="at">addUniqueTodo</span>(title) <span class="op">{</span></a>
<a class="sourceLine" id="cb109-2" data-line-number="2">  <span class="cf">return</span> (dispatch<span class="op">,</span> getState) <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb109-3" data-line-number="3">    <span class="kw">const</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb109-4" data-line-number="4">      <span class="dt">todo</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb109-5" data-line-number="5">        todos<span class="op">,</span></a>
<a class="sourceLine" id="cb109-6" data-line-number="6">      <span class="op">},</span></a>
<a class="sourceLine" id="cb109-7" data-line-number="7">    <span class="op">}</span> <span class="op">=</span> <span class="at">getState</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb109-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb109-9" data-line-number="9">    <span class="co">// stateに保存されたTodoに同一のタイトルがあったら登録済み</span></a>
<a class="sourceLine" id="cb109-10" data-line-number="10">    <span class="kw">const</span> isDuplicated <span class="op">=</span> <span class="va">todos</span>.<span class="at">some</span>(todo <span class="op">=&gt;</span> <span class="va">todo</span>.<span class="at">title</span> <span class="op">===</span> title)<span class="op">;</span></a>
<a class="sourceLine" id="cb109-11" data-line-number="11">    </a>
<a class="sourceLine" id="cb109-12" data-line-number="12">    <span class="cf">if</span> (isDuplicated) <span class="op">{</span></a>
<a class="sourceLine" id="cb109-13" data-line-number="13">      <span class="cf">return</span><span class="op">;</span></a>
<a class="sourceLine" id="cb109-14" data-line-number="14">    <span class="op">}</span></a>
<a class="sourceLine" id="cb109-15" data-line-number="15">    <span class="at">dispatch</span>(<span class="at">addTodo</span>(title))<span class="op">;</span></a>
<a class="sourceLine" id="cb109-16" data-line-number="16">  <span class="op">};</span></a>
<a class="sourceLine" id="cb109-17" data-line-number="17"><span class="op">}</span></a></code></pre></div>
<p>この処理はReducerでもできますが、ActionCreatorで処理すると次のメリットがあります。</p>
<ol>
<li><p>すべてのstateを参照できる</p>
<p>分割されたReducerは、ほかのReducerが持っているstateを参照することができません。 ほかのReducerが持っているstateを使ってActionの動作を振り分けたいときは、ActionCreatorでgetStateするのがよいでしょう。</p></li>
<li><p>Action、Reducerの処理を簡潔にできる</p>
<p>〝ActionをどうDispatchするか〟の部分をActionCreatorとして切り出しておくことで、アクションとそれに対応するReducerの処理を簡潔にできます。</p></li>
</ol>
<h2>UIをきれいにする</h2>
<h3>style属性を使う方法</h3>
<p>※style属性を使っての指定は非推奨です。</p>
<ul>
<li>JSXのstyle属性を使って、直接スタイルを適用できる。</li>
<li>オブジェクトのキーにCSSプロパティをキャメルケースで指定、オブジェクトの値にCSSの値を指定します。</li>
<li><p>値にNumber型を指定したときは自動でpxが追加されます。px以外の単位を指定するときは、単位付きの値を文字列で指定します。</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="co">// font-size: 20px</span></a>
<a class="sourceLine" id="cb110-2" data-line-number="2"><span class="op">&lt;</span>div style<span class="op">={{</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">20</span> <span class="op">}}&gt;</span></a>
<a class="sourceLine" id="cb110-3" data-line-number="3">  Hello World</a>
<a class="sourceLine" id="cb110-4" data-line-number="4">&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb110-5" data-line-number="5"></a>
<a class="sourceLine" id="cb110-6" data-line-number="6"><span class="co">// font-size: 2em</span></a>
<a class="sourceLine" id="cb110-7" data-line-number="7"><span class="op">&lt;</span>div style<span class="op">={{</span> <span class="dt">fontSize</span><span class="op">:</span> <span class="st">&quot;2em&quot;</span> <span class="op">}}&gt;</span></a>
<a class="sourceLine" id="cb110-8" data-line-number="8">  Hello World</a>
<a class="sourceLine" id="cb110-9" data-line-number="9">&lt;/div<span class="op">&gt;</span></a></code></pre></div></li>
<li><p>ベンダープレフィクスは自動で付与されません。自分で指定する必要があります。</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="kw">const</span> style <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb111-2" data-line-number="2">  <span class="co">// ベンダープレフィクス付きのスタイル</span></a>
<a class="sourceLine" id="cb111-3" data-line-number="3">  <span class="dt">WebkitTransition</span><span class="op">:</span> <span class="st">&quot;all&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb111-4" data-line-number="4">  <span class="co">// 通常のスタイル</span></a>
<a class="sourceLine" id="cb111-5" data-line-number="5">  <span class="dt">transition</span><span class="op">:</span> <span class="st">&quot;all&quot;</span></a>
<a class="sourceLine" id="cb111-6" data-line-number="6"><span class="op">};</span></a>
<a class="sourceLine" id="cb111-7" data-line-number="7"></a>
<a class="sourceLine" id="cb111-8" data-line-number="8"><span class="kw">const</span> HelloWorldComponent <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb111-9" data-line-number="9">  <span class="cf">return</span> <span class="op">&lt;</span>div style<span class="op">={</span> style <span class="op">}&gt;</span>Hello World&lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb111-10" data-line-number="10"><span class="op">}</span></a></code></pre></div></li>
</ul>
<h3>className属性を使う方法</h3>
<p>JSXのclassName属性を使って、CSSクラスの指定ができます。className属性に指定した内容が、HTMLのclass属性となります。</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">const</span> Button <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb112-2" data-line-number="2">  <span class="cf">return</span> <span class="op">&lt;</span>button className<span class="op">=</span><span class="st">&quot;normal-button&quot;</span><span class="op">&gt;</span>追加&lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb112-3" data-line-number="3"><span class="op">}</span></a></code></pre></div>
<!-- TODO: p.169 リスト9.4　<button>要素で始まっているのに、閉じタグが</div>　リスト9.6も同様 -->
<p><code>webpack</code>、<code>css-loader</code>、<code>style-loader</code>などのライブラリを組み合わせることで、JavaScriptからCSSファイルの読み込みができるようになります。 <code>create-react-app</code>では、標準でCSSファイルのインポートがサポートされています。</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="im">import</span> <span class="st">&quot;./style.css&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb113-2" data-line-number="2"></a>
<a class="sourceLine" id="cb113-3" data-line-number="3"><span class="kw">const</span> Button <span class="op">=</span> () <span class="op">=&gt;</span></a>
<a class="sourceLine" id="cb113-4" data-line-number="4">  <span class="op">&lt;</span>button className<span class="op">=</span><span class="st">&quot;normal-button&quot;</span><span class="op">&gt;</span>追加&lt;/button<span class="op">&gt;;</span></a>
<a class="sourceLine" id="cb113-5" data-line-number="5"></a>
<a class="sourceLine" id="cb113-6" data-line-number="6"><span class="im">export</span> <span class="im">default</span> Button<span class="op">;</span></a></code></pre></div>
<h3>UIライブラリを使う</h3>
<ul>
<li><p>Material-UI</p>
<p>マテリアルデザインに沿って作られたUIライブラリ。</p></li>
<li><p>React-Bootstrap</p>
<p>BootstrapをReact向けのUIライブラリとして実装したもの。</p></li>
<li><p>React Desktop</p>
<p>デスクトップネイティブアプリの開発を想定したReact向けUIライブラリ。 Electronなどで利用します。</p></li>
<li><p>Onsen UI</p>
<p>ネイティブアプリライクなモバイルウェブアプリの作成に特化したUIライブラリ。</p></li>
</ul>
<h3>Material-UI</h3>
<p>マテリアルデザインに則ったUIを簡単に実装することができます。 ボタンやフォームなどの基本的なUIパーツが網羅されています。</p>
<p>各UIパーツはReactコンポーネントとして実装されており、props経由でコンポーネントをカスタマイズできます。</p>
<p>パッケージは、次のコマンドでインストールできます。</p>
<p>こちらだと v0.20.0 がインストールされます。</p>
<pre><code>&gt; npm install --save material-ui</code></pre>
<p>最新をインストールしたければ次のコマンドにします。 2018年3月8日時点で v1.0.0-beta.36がインストールされました。</p>
<pre><code>&gt; npm install --save material-ui@next</code></pre>
<p>※以降のサンプルは<code>@next</code>でインストールしたものを対象としています。</p>
<h4>使い方</h4>
<p><code>src/components/TodoApp.js</code>を修正します。</p>
<ol>
<li><p>インポートを追加します。</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb116-1" data-line-number="1"><span class="im">import</span> Reboot <span class="im">from</span> <span class="st">'material-ui/Reboot'</span><span class="op">;</span></a>
<a class="sourceLine" id="cb116-2" data-line-number="2"><span class="im">import</span> Button <span class="im">from</span> <span class="st">'material-ui/Button'</span><span class="op">;</span></a></code></pre></div></li>
<li><p>Rebootコンポーネントを追加します。 場所はどこでもよいですが、今回はルート要素の最初の子要素にしました。</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">TodoApp</span>(<span class="op">{</span> task<span class="op">,</span> tasks<span class="op">,</span> inputTask<span class="op">,</span> addTask<span class="op">,</span> redirectToError <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb117-2" data-line-number="2">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb117-3" data-line-number="3">    <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb117-4" data-line-number="4">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> onChange<span class="op">={</span>(e) <span class="op">=&gt;</span> <span class="at">inputTask</span>(<span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span>)<span class="op">}</span> /&gt;</a></code></pre></div>
<p>↓</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="im">export</span> <span class="im">default</span> <span class="kw">function</span> <span class="at">TodoApp</span>(<span class="op">{</span> task<span class="op">,</span> tasks<span class="op">,</span> inputTask<span class="op">,</span> addTask<span class="op">,</span> redirectToError <span class="op">}</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb118-2" data-line-number="2"> <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb118-3" data-line-number="3">   <span class="op">&lt;</span>div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb118-4" data-line-number="4">     <span class="op">&lt;</span>Reboot /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb118-5" data-line-number="5">     <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> onChange<span class="op">={</span>(e) <span class="op">=&gt;</span> <span class="at">inputTask</span>(<span class="va">e</span>.<span class="va">target</span>.<span class="at">value</span>)<span class="op">}</span> /&gt;</a></code></pre></div></li>
<li><p>input要素で作っていたボタンを、Buttonコンポーネントに変更します。</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;button&quot;</span> value<span class="op">=</span><span class="st">&quot;add&quot;</span> onClick<span class="op">={</span>() <span class="op">=&gt;</span> <span class="at">addTask</span>(task)<span class="op">}</span> /&gt;</a></code></pre></div>
<p>↓</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="op">&lt;</span>Button variant<span class="op">=</span><span class="st">&quot;raised&quot;</span> className<span class="op">=</span><span class="st">&quot;default&quot;</span> onClick<span class="op">={</span>() <span class="op">=&gt;</span> <span class="at">addTask</span>(task)<span class="op">}&gt;</span>add&lt;/Button<span class="op">&gt;</span></a></code></pre></div></li>
</ol>
</body>
</html>
