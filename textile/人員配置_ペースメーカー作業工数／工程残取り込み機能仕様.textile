<!-- 人員配置モニター -->

h1. ペースメーカー作業工数／工程残取り込み機能仕様


h2. リアルデータの取り込み


h3. ファイルフォーマット

|_. 設定項目 |_. 設定値 |
| 文字コード | EUC-JP |
| ヘッダ行 | なし |
| 項目の区切り文字 | カンマ |
| レコード区切り文字<br>（改行コード） | LF |
| 項目を囲むかどうか | 各項目を常にダブルクォートで囲む |


h3. レコードフォーマット

|_. 項目名 |_. サイズ |_. 編集 |_. Null許容 |
| 日付 | 8 | YYYYMMDD | No |
| 工程 | 50 | | No |
| 作業工数 | 7,1 | N.N | No |
| 在庫 | 7,1 | N.N | No |
| 前残 | 7,1 | N.N | No |


h3. 対象ファイルの検索

定周期で対象ディレクトリを監視し、ファイル名が一致するファイルを取り込む。

対象ディレクトリ＝/u01/users/edph/wip0/tmp/JI/realData
ファイル名＝PACE_MAKER_REAL.csv


h3. ファイルの取り込み

ファイル名を変更する。
次のいずれかに該当する場合は、そのファイルの取り込みをスキップする。

* ファイル名の変更に失敗した場合
* 変更後のファイル名と同じ名前のファイルが存在する場合

形式:
元のファイル名（拡張子除く） ＋ "." ＋ ファイルの最終更新日時（yyyyMMddHHmmss） ＋ "." ＋ 拡張子

例:
PACE_MAKER_REAL.csv
↓
PACE_MAKER_REAL.20170901203010.csv


ファイル内の各レコードの項目数を数える。
項目数がデータフォーマットの定義より少ないレコードがある場合、そのファイルの取り込みをスキップする。


h3. 値の変換、検証、取り込み

h4. 日付

日付型に変換する。
変換できない場合、そのレコードの取り込みをスキップする。


h4. 工程

工程を部屋コードに変換する。

ＯＰ工程部屋変換マスタから読み込んだ工程と同じ工程名称のレコードを検索する。
次のいずれかに該当する場合、そのレコードの取り込みをスキップする。

* 検索結果＝0件の場合
* ペースメーカー取り込み対象外の場合
* 部屋コードが定義されていない（部屋コードをトリムした結果が空文字である）場合


h4. 作業工数

数値に変換する。

四捨五入する。

ＯＰ実績在庫データ履歴．実績に作業工数を登録する。
「日付」「工程」を変換した部屋コードに該当するレコードを対象とする。

ただし、次のいずれかに該当する場合は取り込みをスキップする。

* 数値に変換できない場合
* 作業工数（四捨五入後） ＞ 999999 の場合
* 作業工数（四捨五入後） ＜ -999999 の場合


h4. 在庫

数値に変換する。

四捨五入する。

ＯＰロット残情報データ．ロット残数に在庫を登録する。
「工程」を変換した部屋コードに該当するレコードを対象とする。

ただし、次のいずれかに該当する場合は取り込みをスキップする。

* 数値に変換できない場合
* 在庫（四捨五入後） ＞ 9999 の場合
* 在庫（四捨五入後） ＜ -9999 の場合


h4. 前残

数値に変換する。

四捨五入する。

ＯＰロット前残情報データ．ロット前残数に前残を登録する。
「工程」を変換した部屋コードに該当するレコードを対象とする。

ただし、次のいずれかに該当する場合は取り込みをスキップする。

* 数値に変換できない場合
* 前残（四捨五入後） ＞ 999 の場合
* 前残（四捨五入後） ＜ -999 の場合


h3. ファイル削除

ファイルを削除する。
ただし、次のいずれかに該当する場合は削除しない。

* レコードの項目数がデータフォーマットの定義より少ないレコードが存在する場合
* 日付の変換に失敗したレコードが存在する場合
* 作業工数の取り込みをスキップしたレコードが存在する場合
* 在庫の取り込みをスキップしたレコードが存在する場合
* 前残の取り込みをスキップしたレコードが存在する場合



h2. 確定データの取り込み

※原則、リアルデータと同様。
　異なる点のみ以下に記載する。


h3. 対象ファイルの検索

定周期で対象ディレクトリを監視し、ファイル名が一致するファイルを取り込む。

対象ディレクトリ＝/u01/users/edph/wip0/tmp/JI/decisionData
ファイル名＝PACE_MAKER_DAY.yyyyMMdd.csv
　※yyyyMMddには日付が入る。


h3. 取り込む値

作業工数のみ取り込む。
在庫、前残は取り込まない。
（履歴管理していないため）
